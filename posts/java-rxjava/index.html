<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>RxJava | XhstormR</title><meta name=keywords content="JAVA"><meta name=description content="RxJava - XhstormR"><meta name=author content><link rel=canonical href=https://xhstormr.github.io/blog/posts/java-rxjava/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.a090830a421002426baafbd314e38f149d77b4c48a12ee9312700d770b27fb26.css integrity="sha256-oJCDCkIQAkJrqvvTFOOPFJ13tMSKEu6TEnANdwsn+yY=" rel="preload stylesheet" as=style><link rel=icon href=https://xhstormr.github.io/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://xhstormr.github.io/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://xhstormr.github.io/blog/favicon-32x32.png><link rel=apple-touch-icon href=https://xhstormr.github.io/blog/apple-touch-icon.png><link rel=mask-icon href=https://xhstormr.github.io/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://xhstormr.github.io/blog/posts/java-rxjava/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://xhstormr.github.io/blog/posts/java-rxjava/"><meta property="og:site_name" content="XhstormR"><meta property="og:title" content="RxJava"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-11-13T19:48:15+08:00"><meta property="article:modified_time" content="2016-11-13T19:48:15+08:00"><meta property="article:tag" content="JAVA"><meta name=twitter:card content="summary"><meta name=twitter:title content="RxJava"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://xhstormr.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"RxJava","item":"https://xhstormr.github.io/blog/posts/java-rxjava/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"RxJava","name":"RxJava","description":"","keywords":["JAVA"],"articleBody":"Updated on 2016-11-22\n观察者模式\n响应式编程 | 函数式编程\nhttps://github.com/ReactiveX/RxJava\nhttp://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Observable.html\nOperators | Operators\nBook | Book\nJava Native import java.util.Observable; import java.util.Observer; public class Main { public static void main(String[] args) { Subject subject = new Subject(); Consumer consumer = new Consumer(); subject.addObserver(consumer); // 被观察者添加观察者 subject.setData(\"123\"); subject.setData(\"123\"); subject.setData(\"456\"); subject.setData(\"456\"); } private static class Subject extends Observable { // 被观察者需要继承类 private String data = \"\"; public String getData() { return data; } public void setData(String data) { if (data == null || this.data.equals(data)) return; // 过滤无效数据 this.data = data; setChanged(); // 设置 flag notifyObservers(data); // 通知观察者 } } private static class Consumer implements Observer { // 观察者需要实现接口 @Override public void update(Observable o, Object arg) { System.out.println(\"Update: \" + arg); } } } ---- 输出： Update: 123 Update: 456 Observable - 被观察者 Observable\u003cString\u003e observable = Observable.create(new Observable.OnSubscribe\u003cString\u003e() { 传入 OnSubscribe，描述事件 @Override public void call(Subscriber\u003c? super String\u003e subscriber) { 作为参数传入的观察者 subscriber.onNext(\"A\"); 事件 subscriber.onNext(\"B\"); subscriber.onNext(\"C\"); subscriber.onCompleted(); } }); ---- Observable\u003cString\u003e observable = Observable.create(subscriber -\u003e { 简化为 Lambda 表达式 subscriber.onNext(\"A\"); subscriber.onNext(\"B\"); subscriber.onNext(\"C\"); subscriber.onCompleted(); }); ------------------------------------------------------- Observable\u003cString\u003e observable = Observable.just(\"A\", \"B\", \"C\"); 快捷方式 ------------------------------------------------------- List\u003cString\u003e list = Arrays.asList(\"A\", \"B\", \"C\"); Observable\u003cString\u003e observable = Observable.from(list); 快捷方式 ------------------------------------------------------- observable.subscribe(observer); 被观察者订阅观察者（观察者见下文） ---- 输出： A B C onCompleted Note： 0. 被观察者发出事件，观察者处理事件。（可一对多） 1. 一旦被观察者调用 subscribe() 方法订阅观察者，被观察者中的唯一成员 OnSubscribe 将执行 call() 方法并将观察者作为参数传入。 2. 调用 subscribe() 方法后会返回 Subscription 接口对象（仅含 2 个方法 unsubscribe 和 isUnsubscribed），代表被观察者与观察者之间的订阅关系。 Observer - 观察者 Observer\u003cString\u003e observer = new Observer\u003cString\u003e() { 接口（最终会被包装为 Subscriber） @Override public void onCompleted() { 完成事件（调用链结束） System.out.println(\"onCompleted\"); } @Override public void onError(Throwable e) { 出现异常，框架自动调用（调用链结束） System.out.println(\"onError\"); } @Override public void onNext(String s) { 处理事件 System.out.println(s); } }; ------------------------------------------------------- Subscriber\u003cString\u003e subscriber = new Subscriber\u003cString\u003e() { 抽象类（继承但未实现 Observer 接口，且可选择性重写 onStart 方法） @Override public void onCompleted() { 完成事件（调用链结束） System.out.println(\"onCompleted\"); } @Override public void onError(Throwable e) { 出现异常，框架自动调用（调用链结束） System.out.println(\"onError\"); } @Override public void onNext(String s) { 处理事件 System.out.println(s); } }; 调用链：onStart() --\u003e onNext() --\u003e onCompleted() | | ↳ onError() | ↳ 此方法只能在调用 subscribe() 的线程上执行，可通过操作符 doOnSubscribe(Action0) 替代且可指定运行线程 ↳ 当调用链结束后，订阅关系自动解除（Subscription.isUnsubscribed = true） ------------------------------------------------------- Action1\u003cString\u003e action1 = new Action1\u003cString\u003e() { 快捷方式（被观察者的 subscribe() 方法支持传入 Action1 接口充当 onNext） @Override public void call(String s) { System.out.println(s); } }; ---- Action1\u003cString\u003e action1 = s -\u003e System.out.println(s); 简化为 Lambda 表达式 Action1\u003cString\u003e action1 = System.out::println; 简化为方法引用 Scheduler - 线程调度 默认情况下调用链（事件流）在调用 subscribe() 的线程上运行，可以通过以下 2 种方法指定运行线程：\n（一次）subscribeOn()：指定其运行线程。 （多次）observeOn()：切换其运行线程。 subscribeOn() 用于指定最开始调用链（事件流）的运行线程，后期可通过 observeOn() 随时切换其运行线程。 Observable .create((Observable.OnSubscribe\u003cString\u003e) subscriber -\u003e { Log.w(\"Tag\", \"create__\" + Thread.currentThread().toString()); subscriber.onNext(\"\"); subscriber.onCompleted(); }) .observeOn(Schedulers.computation()) 切换至计算线程 (2) .map(s -\u003e { Log.w(\"Tag\", \"map__\" + Thread.currentThread().toString()); return s; }) .observeOn(AndroidSchedulers.mainThread()) 切换至主线程 (3) .subscribeOn(Schedulers.io()) 指定最开始在IO线程中运行 (1) .subscribe(new Subscriber\u003cString\u003e() { @Override public void onCompleted() { Log.w(\"Tag\", \"onCompleted__\" + Thread.currentThread().toString()); } @Override public void onError(Throwable e) { Log.w(\"Tag\", \"onError\"); } @Override public void onNext(String s) { Log.w(\"Tag\", \"onNext__\" + Thread.currentThread().toString()); } }); ---- 输出： 23701-14945/com.example.myapp.myapplication W/Tag: create__Thread[RxIoScheduler-3,5,main] IO 线程 23701-23824/com.example.myapp.myapplication W/Tag: map__Thread[RxComputationScheduler-2,5,main] 计算线程 23701-23701/com.example.myapp.myapplication W/Tag: onNext__Thread[main,5,main] 主线程 23701-23701/com.example.myapp.myapplication W/Tag: onCompleted__Thread[main,5,main] 主线程 ------------------------------------------------------- 实例：加载网络图片 ---- Observable .just(\"http://blog.xhstormr.tk/uploads/children-of-the-sun1.jpg\") .map(s -\u003e { 下载 Bitmap（String ➜ Bitmap） Bitmap bitmap = null; try (BufferedInputStream bufferedInputStream = new BufferedInputStream(new URL(s).openStream())) { bitmap = BitmapFactory.decodeStream(bufferedInputStream); } catch (IOException e) { e.printStackTrace(); } return bitmap; }) .observeOn(AndroidSchedulers.mainThread()) 切换至主线程 (2) .subscribeOn(Schedulers.io()) 指定最开始在IO线程中运行 (1) .subscribe(bitmap -\u003e mImageView.setImageBitmap(bitmap)); 加载 Bitmap Operators - 操作符 类似于 Java 8 中的 Stream 的内部迭代。\n转换 public class A { private static final List\u003cAuthor\u003e LIST = Arrays.asList( new Author(\"Adam\", 23, Arrays.asList(\"Java1\", \"Java2\")), new Author(\"Bell\", 19, Arrays.asList(\"Python1\", \"Python2\")), new Author(\"Conan\", 23, Arrays.asList(\"PHP1\", \"PHP2\")), new Author(\"David\", 26, Arrays.asList(\"Ruby1\", \"Ruby2\"))); 作家列表 public static void main(String[] args) { Observable .from(LIST) .map(author -\u003e author.mAge) 一对一 .sorted() 排序 .subscribe(integer -\u003e System.out.print(integer + \" \"), System.out::println, () -\u003e System.out.println(\"\\n————————————\")); Observable .from(LIST) .map(author -\u003e author.mAge) 一对一 .sorted() 排序 .scan(0, (i1, i2) -\u003e i1 + i2) 累加器，提供初始值 .subscribe(integer -\u003e System.out.print(integer + \" \"), System.out::println, () -\u003e System.out.println(\"\\n————————————\")); Observable .from(LIST) .map(author -\u003e author.mAge) 一对一 .reduce(0, (i1, i2) -\u003e i1 + i2) 累加器，提供初始值 .subscribe(integer -\u003e System.out.print(integer + \" \"), System.out::println, () -\u003e System.out.println(\"\\n————————————\")); Observable .from(LIST) .flatMap(author -\u003e Observable.from(author.mArticle)) 一对多（手动转换为 Observable）（推荐使用 concatMap，解决 flatMap 事件交叉问题）（flatMap() 底层调用 merge()，concatMap 底层调用 concat()，下同） .subscribe(System.out::println, System.out::println, () -\u003e System.out.println(\"————————————\")); Observable .from(LIST) .flatMapIterable(author -\u003e author.mArticle) 一对多（自动转换为 Observable）（推荐使用 concatMapIterable，解决 flatMapIterable 事件交叉问题） .subscribe(System.out::println, System.out::println, () -\u003e System.out.println(\"————————————\")); Observable .from(LIST) .groupBy(author -\u003e author.mAge) 按年龄将事件流分组 .concatMap(groupedObservable -\u003e groupedObservable) 一对多 .subscribe(author -\u003e System.out.printf(\"年龄:%d 姓名:%s\\n\", author.mAge, author.mName), System.out::println, () -\u003e System.out.println(\"————————————\")); } private static class Author { 作家 private String mName; 姓名 private int mAge; 年龄 private List\u003cString\u003e mArticle; 文章列表 private Author(String name, int age, List\u003cString\u003e article) { mName = name; mAge = age; mArticle = article; } @Override public String toString() { return mName; } } } ---- 输出： 19 23 23 26 ———————————— 0 19 42 65 91 ———————————— 91 ———————————— Java1 Java2 Python1 Python2 PHP1 PHP2 Ruby1 Ruby2 ———————————— Java1 Java2 Python1 Python2 PHP1 PHP2 Ruby1 Ruby2 ———————————— 年龄:23 姓名:Adam 年龄:23 姓名:Conan 年龄:19 姓名:Bell 年龄:26 姓名:David ———————————— 过滤 public class A { private static final List\u003cAuthor\u003e LIST = Arrays.asList( new Author(\"Adam\", 23, Arrays.asList(\"Java1\", \"Java2\")), new Author(\"Bell\", 19, Arrays.asList(\"Python1\", \"Python2\")), new Author(\"Conan\", 23, Arrays.asList(\"PHP1\", \"PHP2\")), new Author(\"David\", 26, Arrays.asList(\"Ruby1\", \"Ruby2\"))); public static void main(String[] args) { Observable .from(LIST) .filter(author -\u003e author.mAge \u003e 25) 过滤 .subscribe(author -\u003e System.out.printf(\"年龄:%d 姓名:%s\\n\", author.mAge, author.mName), System.out::println, () -\u003e System.out.println(\"————————————\")); Observable .from(LIST) .take(2) 只取前 2 .subscribe(System.out::println, System.out::println, () -\u003e System.out.println(\"————————————\")); Observable .from(LIST) .takeLast(2) 只取后 2 .subscribe(System.out::println, System.out::println, () -\u003e System.out.println(\"————————————\")); Observable .from(LIST) .skip(2) 跳过前 2 .subscribe(System.out::println, System.out::println, () -\u003e System.out.println(\"————————————\")); Observable .from(LIST) .skipLast(2) 跳过后 2 .subscribe(System.out::println, System.out::println, () -\u003e System.out.println(\"————————————\")); Observable .from(LIST) .elementAt(0) 选取 .subscribe(System.out::println, System.out::println, () -\u003e System.out.println(\"————————————\")); Observable .from(LIST) .first() 选取最前（若无数据：first() 直接调用 onError()，takeFirst() 直接调用 onCompleted()，下同） .subscribe(System.out::println, System.out::println, () -\u003e System.out.println(\"————————————\")); Observable .from(LIST) .last() 选取最后 .subscribe(System.out::println, System.out::println, () -\u003e System.out.println(\"————————————\")); Observable .from(Arrays.asList(1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 1, 2, 3, 4, 5, 6)) .distinct() 去重 .subscribe(integer -\u003e System.out.print(integer + \" \"), System.out::println, () -\u003e System.out.println(\"\\n————————————\")); Observable .from(Arrays.asList(1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 1, 2, 3, 4, 5, 6)) .distinctUntilChanged() 前后去重 .subscribe(integer -\u003e System.out.print(integer + \" \"), System.out::println, () -\u003e System.out.println(\"\\n————————————\")); ---- 输出： 年龄:26 姓名:David ———————————— Adam Bell ———————————— Conan David ———————————— Conan David ———————————— Adam Bell ———————————— Adam ———————————— Adam ———————————— David ———————————— 1 2 3 4 5 6 ———————————— 1 2 3 4 5 6 1 2 3 4 5 6 ———————————— } private static void a() throws InterruptedException { takeUntil Observable .from(Arrays.asList(1, 2, 3, 4, 5, 6)) .takeUntil(integer -\u003e integer == 3) 一直处理事件，直到事件符合某项条件 .subscribe(System.out::println); ---- 输出： 1 2 3 Observable\u003cLong\u003e observable1 = Observable.interval(300, TimeUnit.MILLISECONDS); 每隔 300 毫秒发送数字 Observable\u003cLong\u003e observable2 = Observable.interval(800, TimeUnit.MILLISECONDS); 每隔 800 毫秒发送数字 observable1 .takeUntil(observable2) 一直处理事件，直到 observable2 发送了事件 .subscribe(System.out::println, System.out::println, () -\u003e System.exit(0)); Thread.sleep(Integer.MAX_VALUE); ---- 输出： 0 1 } private static class Author { private String mName; private int mAge; private List\u003cString\u003e mArticle; private Author(String name, int age, List\u003cString\u003e article) { mName = name; mAge = age; mArticle = article; } @Override public String toString() { return mName; } } } 组合 public class A { private static String[] strings = {\"A\", \"B\", \"C\", \"D\", \"E\"}; private static Observable\u003cString\u003e observable1 = Observable 每隔 300 毫秒发送事件：A B C D E .interval(300, TimeUnit.MILLISECONDS) .take(strings.length) .map(aLong -\u003e strings[aLong.intValue()]); private static Observable\u003cLong\u003e observable2 = Observable 每隔 500 毫秒发送事件：0 1 2 3 4 5 6 7 8 9 .interval(500, TimeUnit.MILLISECONDS) .take(10); public static void main(String[] args) throws InterruptedException { a(); b(); Thread.sleep(Integer.MAX_VALUE); } private static void a() { 合并 Observable .merge(observable1, observable2) 无序合并（异步进行） .subscribe(o -\u003e System.out.print(o + \" \"), System.out::println, () -\u003e System.exit(0)); ---- 输出： A 0 B C 1 D E 2 3 4 5 6 7 8 9 Observable .concat(observable1, observable2) 有序合并（同步进行） .subscribe(o -\u003e System.out.print(o + \" \"), System.out::println, () -\u003e System.exit(0)); ---- 输出： A B C D E 0 1 2 3 4 5 6 7 8 9 observable1 .startWith(Observable.just(\"AA\", \"BB\", \"CC\")) 有序合并（同步进行），底层调用 concat 在其之前插入新事件，接收 Observable 和 Iterable .subscribe(o -\u003e System.out.print(o + \" \"), System.out::println, () -\u003e System.exit(0)); ---- 输出： AA BB CC A B C D E } private static void b() { 组合 Observable .zip(observable1, observable2, (s, aLong) -\u003e s + aLong) 不可重用 .subscribe(o -\u003e System.out.print(o + \" \"), System.out::println, () -\u003e System.exit(0)); ---- 输出： A0 B1 C2 D3 E4 Observable .combineLatest(observable1, observable2, (s, aLong) -\u003e s + aLong) 可重用（与最近的事件组合） .subscribe(o -\u003e System.out.print(o + \" \"), System.out::println, () -\u003e System.exit(0)); ---- 输出： A0 B0 C0 C1 D1 E1 E2 E3 E4 E5 E6 E7 E8 E9 observable1 左事件源 .join( 可重用（事件具有有效期，有点像排列组合） observable2, 右事件源 s -\u003e Observable.timer(10000, TimeUnit.MILLISECONDS), 左事件有效期 aLong -\u003e Observable.timer(0, TimeUnit.MILLISECONDS), 右事件有效期 (s, aLong) -\u003e s + aLong) .subscribe(o -\u003e System.out.print(o + \" \"), System.out::println, () -\u003e System.exit(0)); ---- 输出： A0 A1 B1 C1 A2 B2 C2 D2 E2 A3 B3 C3 D3 E3 A4 B4 C4 D4 E4 A5 B5 C5 D5 E5 A6 B6 C6 D6 E6 A7 B7 C7 D7 E7 A8 B8 C8 D8 E8 A9 B9 C9 D9 E9 } } Code Observable .just(\"A\", \"B\", \"C\") .doOnNext(s -\u003e System.out.printf(\"%s__%s__%s\\n\", s, Thread.currentThread().getName(), \"doOnNext\")) 类似于 Java 8 中的 Stream 的 peek .map(s -\u003e { System.out.printf(\"%s__%s__%s\\n\", s, Thread.currentThread().getName(), \"map\"); return s; }) .subscribe(s -\u003e System.out.printf(\"%s__%s__%s\\n\", s, Thread.currentThread().getName(), \"onNext\"), System.out::println, () -\u003e System.exit(0)); Thread.sleep(Integer.MAX_VALUE); ---- 输出： 类似于 Java 8 中的 Stream 的垂直执行，像在流水线依次经过每个操作，并通过短路求值尽可能减少操作次数 A__main__doOnNext A__main__map A__main__onNext B__main__doOnNext B__main__map B__main__onNext C__main__doOnNext C__main__map C__main__onNext ------------------------------------------------------- Observable .just(\"A\", \"B\", \"C\") .doOnNext(s -\u003e System.out.printf(\"%s__%s__%s\\n\", s, Thread.currentThread().getName(), \"doOnNext\")) .map(s -\u003e { System.out.printf(\"%s__%s__%s\\n\", s, Thread.currentThread().getName(), \"map\"); return s; }) .observeOn(Schedulers.computation()) 切换至计算线程 (2) .subscribeOn(Schedulers.io()) 指定最开始在IO线程中运行 (1) .subscribe(s -\u003e System.out.printf(\"%s__%s__%s\\n\", s, Thread.currentThread().getName(), \"onNext\"), System.out::println, () -\u003e System.exit(0)); Thread.sleep(Integer.MAX_VALUE); ---- 输出： A__RxIoScheduler-2__doOnNext A__RxIoScheduler-2__map B__RxIoScheduler-2__doOnNext B__RxIoScheduler-2__map C__RxIoScheduler-2__doOnNext C__RxIoScheduler-2__map A__RxComputationScheduler-1__onNext B__RxComputationScheduler-1__onNext C__RxComputationScheduler-1__onNext 通过 compose() 操作符重用操作链 ------------------------------------------------------- public class A { public static void main(String[] args) { final Observable.Transformer\u003cString, String\u003e transformer = new Observable.Transformer\u003cString, String\u003e() { @Override public Observable\u003cString\u003e call(Observable\u003cString\u003e stringObservable) { 对传入的原始被观察者进行加工 return stringObservable.doOnUnsubscribe(() -\u003e System.out.println(\"Unsubscribed\")).map(s -\u003e s + \"1\"); } }; Transformer 对象 Observable .just(\"A\", \"B\", \"C\") .compose(transformer) 重用 Transformer .subscribe(System.out::println); Observable .just(\"1\", \"2\", \"3\") .compose(transformer) 重用 Transformer .subscribe(System.out::println); } } ---- 输出： A1 B1 C1 Unsubscribed 11 21 31 Unsubscribed Note： 1. compose() 接收一个 Transformer 接口，此接口继承自 Func1，接收原始 Observable，返回新 Observable。 2. compose() 作用于整个被观察者，flatMap() 作用于每个事件。 ------------------------------------------------------- 实例：改进之前线程调度加载网络图片的例子 ---- public class A { private static final Observable.Transformer\u003cObject, Object\u003e mTransformer = observable -\u003e 单例模式 observable .observeOn(AndroidSchedulers.mainThread()) 切换至主线程 (2) .subscribeOn(Schedulers.io()); 指定最开始在IO线程中运行 (1) @SuppressWarnings(\"unchecked\") 压制警告（强制类型转换） public static \u003cT\u003e Observable.Transformer\u003cT, T\u003e applySchedulers() { return ((Observable.Transformer\u003cT, T\u003e) mTransformer); 返回 Transformer 对象（为了不丢失类型信息而强制转换） } } ---- Observable .just(\"http://blog.xhstormr.tk/uploads/children-of-the-sun1.jpg\") .map(s -\u003e { 下载 Bitmap（String ➜ Bitmap） Bitmap bitmap = null; try (BufferedInputStream bufferedInputStream = new BufferedInputStream(new URL(s).openStream())) { bitmap = BitmapFactory.decodeStream(bufferedInputStream); } catch (IOException e) { e.printStackTrace(); } return bitmap; }) .compose(A.applySchedulers()) 只需传入 A.applySchedulers() 返回的对象，即可后台处理，前台显示 .subscribe(bitmap -\u003e mImageView.setImageBitmap(bitmap)); 加载 Bitmap 通过 Observable.defer(Func0) 实现延迟订阅 ------------------------------------------------------- public class A { private static String s; public static void main(String[] args) { Observable\u003cString\u003e observable = Observable.just(s); 直接执行 s = \"ABC\"; observable.subscribe(System.out::println); ---- 输出： null Observable\u003cString\u003e observable = Observable.defer(() -\u003e Observable.just(s)); Func0 接口中的代码将延迟执行 s = \"ABC\"; observable.subscribe(System.out::println); ---- 输出： ABC } } Note： 0. just() 和 from() 在创建 Observable 时就存储了对象的值，而 create() 创建的 Observable 在 subscribe() 时才访问对象。 1. defer() 接收一个 Func0 接口并显式声明此接口返回一个 Observable 对象。 2. defer() 中的代码直到订阅才会执行。 通过 Schedulers 将耗时操作放到后台线程中执行 ------------------------------------------------------- public class A { public static void main(String[] args) throws InterruptedException { Schedulers.io().createWorker().schedule(() -\u003e { Action0 接口中的代码将在 IO 线程中执行 System.out.println(Thread.currentThread()); System.exit(0); }); Thread.sleep(Integer.MAX_VALUE); } } ---- 输出： Thread[RxIoScheduler-2,5,main] Single ------------------------------------------------------- 被观察者 ---- Single\u003cString\u003e observable = Single.create(new Single.OnSubscribe\u003cString\u003e() { @Override public void call(SingleSubscriber\u003c? super String\u003e singleSubscriber) { singleSubscriber.onSuccess(\"A\"); } }); Single\u003cString\u003e observable = Single.just(\"A\"); 观察者 ---- SingleSubscriber\u003cString\u003e subscriber = new SingleSubscriber\u003cString\u003e() { SingleSubscriber @Override public void onSuccess(String value) { 成功 System.out.println(value); } @Override public void onError(Throwable error) { 异常 System.out.println(error.toString()); } }; 实例 ---- Single.just(\"A\").subscribe(System.out::println); ---- 输出： A 延时执行 ------------------------------------------------------- public class A { public static void main(String[] args) throws InterruptedException { Observable\u003cInteger\u003e range = Observable.range(0, 3); range .delay(2, TimeUnit.SECONDS) 2 秒 .subscribe(System.out::println, System.out::println, () -\u003e System.exit(0)); Thread.sleep(Integer.MAX_VALUE); ---- 输出：（延时 2 秒后执行） 0 1 2 Observable\u003cLong\u003e timer = Observable.timer(2, TimeUnit.SECONDS); 2 秒（timer 操作返回计时器 Observable） timer .delay(2, TimeUnit.SECONDS) 2 秒 .subscribe(System.out::println, System.out::println, () -\u003e System.exit(0)); Thread.sleep(Integer.MAX_VALUE); ---- 输出：（延时 4 秒后执行） 0 } } 缓解 Backpressure（背部压力） ------------------------------------------------------- 缓冲事件 ---- public class A { public static void main(String[] args) throws InterruptedException { Observable .range(0, 10) .buffer(2) 将多个事件包装为 List\u003cT\u003e，缓冲区大小为 2 .subscribe(System.out::println); ---- 输出： [0, 1] [2, 3] [4, 5] [6, 7] [8, 9] Observable .range(0, 10) .buffer(2, 3) 将多个事件包装为 List\u003cT\u003e，缓冲区大小为 2，每次都跳过第 3 个事件 .subscribe(System.out::println); ---- 输出： [0, 1] [3, 4] [6, 7] [9] } } 过滤事件 ---- public class A { public static void main(String[] args) throws InterruptedException { Observable\u003cLong\u003e timer = Observable.timer(5, TimeUnit.SECONDS); 5 秒后发出事件（计时器） Observable .interval(500, TimeUnit.MILLISECONDS) 每隔 500 毫秒发出事件 .takeUntil(timer) 一直处理事件，直到 timer 发送了事件 .subscribe(System.out::println, System.out::println, () -\u003e System.exit(0)); Thread.sleep(Integer.MAX_VALUE); ---- 输出：（CPU 时间不准，无过滤） 0 1 2 3 4 5 6 7 8 Observable .interval(500, TimeUnit.MILLISECONDS) .takeUntil(timer) .throttleFirst(1, TimeUnit.SECONDS) 每隔 1 秒发出时间段中的第一个事件 .subscribe(System.out::println, System.out::println, () -\u003e System.exit(0)); Thread.sleep(Integer.MAX_VALUE); ---- 输出：（CPU 时间不准） 0 3 5 7 Observable .interval(500, TimeUnit.MILLISECONDS) .takeUntil(timer) .throttleLast(1, TimeUnit.SECONDS) 每隔 1 秒发出时间段中的最后一个事件（跟 sample() 行为一致） .subscribe(System.out::println, System.out::println, () -\u003e System.exit(0)); Thread.sleep(Integer.MAX_VALUE); ---- 输出：（CPU 时间不准） 0 2 4 6 8 Observable debounce（去抖） .interval(500, TimeUnit.MILLISECONDS) .takeUntil(timer) .debounce(1, TimeUnit.SECONDS) 1 秒无新事件后，再发送其接收到的最后一个事件 .subscribe(System.out::println, System.out::println, () -\u003e System.exit(0)); Thread.sleep(Integer.MAX_VALUE); ---- 输出：（CPU 时间不准） 8 } } ","wordCount":"2083","inLanguage":"en","datePublished":"2016-11-13T19:48:15+08:00","dateModified":"2016-11-13T19:48:15+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://xhstormr.github.io/blog/posts/java-rxjava/"},"publisher":{"@type":"Organization","name":"XhstormR","logo":{"@type":"ImageObject","url":"https://xhstormr.github.io/blog/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xhstormr.github.io/blog/ accesskey=h title="XhstormR (Alt + H)">XhstormR</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://xhstormr.github.io/blog/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://xhstormr.github.io/blog/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://xhstormr.github.io/blog/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://xhstormr.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://xhstormr.github.io/blog/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">RxJava</h1><div class=post-meta><span title='2016-11-13 19:48:15 +0800 +0800'>2016-11-13</span>&nbsp;·&nbsp;<span>10 min</span>&nbsp;|&nbsp;<span>
<a href=https://github.com/XhstormR/blog/tree/master/content/posts/java-rxjava.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#java-native aria-label="Java Native">Java Native</a></li><li><a href=#observable---%e8%a2%ab%e8%a7%82%e5%af%9f%e8%80%85 aria-label="Observable - 被观察者">Observable - 被观察者</a></li><li><a href=#observer---%e8%a7%82%e5%af%9f%e8%80%85 aria-label="Observer - 观察者">Observer - 观察者</a></li><li><a href=#scheduler---%e7%ba%bf%e7%a8%8b%e8%b0%83%e5%ba%a6 aria-label="Scheduler - 线程调度">Scheduler - 线程调度</a></li><li><a href=#operators---%e6%93%8d%e4%bd%9c%e7%ac%a6 aria-label="Operators - 操作符">Operators - 操作符</a><ul><li><a href=#%e8%bd%ac%e6%8d%a2 aria-label=转换>转换</a></li><li><a href=#%e8%bf%87%e6%bb%a4 aria-label=过滤>过滤</a></li><li><a href=#%e7%bb%84%e5%90%88 aria-label=组合>组合</a></li></ul></li><li><a href=#code aria-label=Code>Code</a></li></ul></div></details></div><div class=post-content><p>Updated on 2016-11-22</p><blockquote><img loading=lazy src=/blog/uploads/java-rxjava.png title=RxJava><p>观察者模式</p><p>响应式编程
|
函数式编程</p><p><a href=https://github.com/ReactiveX/RxJava>https://github.com/ReactiveX/RxJava</a></p><p><a href=http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Observable.html>http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Observable.html</a></p><p><a href=http://reactivex.io/documentation/operators.html>Operators</a>
|
<a href=http://rxmarbles.com/>Operators</a></p><p><a href=https://mcxiaoke.gitbooks.io/rxdocs/content/>Book</a>
|
<a href=https://rxjava.yuxingxin.com/>Book</a></p></blockquote><h2 id=java-native>Java Native<a hidden class=anchor aria-hidden=true href=#java-native>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Observable;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Observer;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Main</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        Subject subject <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Subject();
</span></span><span style=display:flex><span>        Consumer consumer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Consumer();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        subject.<span style=color:#a6e22e>addObserver</span>(consumer); <span style=color:#75715e>// 被观察者添加观察者</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        subject.<span style=color:#a6e22e>setData</span>(<span style=color:#e6db74>&#34;123&#34;</span>);
</span></span><span style=display:flex><span>        subject.<span style=color:#a6e22e>setData</span>(<span style=color:#e6db74>&#34;123&#34;</span>);
</span></span><span style=display:flex><span>        subject.<span style=color:#a6e22e>setData</span>(<span style=color:#e6db74>&#34;456&#34;</span>);
</span></span><span style=display:flex><span>        subject.<span style=color:#a6e22e>setData</span>(<span style=color:#e6db74>&#34;456&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Subject</span> <span style=color:#66d9ef>extends</span> Observable { <span style=color:#75715e>// 被观察者需要继承类</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String data <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getData</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> data;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setData</span>(String data) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (data <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>equals</span>(data)) <span style=color:#66d9ef>return</span>; <span style=color:#75715e>// 过滤无效数据</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> data;
</span></span><span style=display:flex><span>            setChanged(); <span style=color:#75715e>// 设置 flag</span>
</span></span><span style=display:flex><span>            notifyObservers(data); <span style=color:#75715e>// 通知观察者</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Consumer</span> <span style=color:#66d9ef>implements</span> Observer { <span style=color:#75715e>// 观察者需要实现接口</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>update</span>(Observable o, Object arg) {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Update: &#34;</span> <span style=color:#f92672>+</span> arg);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>Update: 123
</span></span><span style=display:flex><span>Update: 456
</span></span></code></pre></div><h2 id=observable---被观察者>Observable - 被观察者<a hidden class=anchor aria-hidden=true href=#observable---被观察者>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Observable<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> observable <span style=color:#f92672>=</span> Observable.<span style=color:#a6e22e>create</span>(<span style=color:#66d9ef>new</span> Observable.<span style=color:#a6e22e>OnSubscribe</span><span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>() {     传入 OnSubscribe<span style=color:#960050;background-color:#1e0010>，</span>描述事件
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>call</span>(Subscriber<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>super</span> String<span style=color:#f92672>&gt;</span> subscriber) {     作为参数传入的观察者
</span></span><span style=display:flex><span>        subscriber.<span style=color:#a6e22e>onNext</span>(<span style=color:#e6db74>&#34;A&#34;</span>);     事件
</span></span><span style=display:flex><span>        subscriber.<span style=color:#a6e22e>onNext</span>(<span style=color:#e6db74>&#34;B&#34;</span>);
</span></span><span style=display:flex><span>        subscriber.<span style=color:#a6e22e>onNext</span>(<span style=color:#e6db74>&#34;C&#34;</span>);
</span></span><span style=display:flex><span>        subscriber.<span style=color:#a6e22e>onCompleted</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Observable<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> observable <span style=color:#f92672>=</span> Observable.<span style=color:#a6e22e>create</span>(subscriber <span style=color:#f92672>-&gt;</span> {     简化为 Lambda 表达式
</span></span><span style=display:flex><span>    subscriber.<span style=color:#a6e22e>onNext</span>(<span style=color:#e6db74>&#34;A&#34;</span>);
</span></span><span style=display:flex><span>    subscriber.<span style=color:#a6e22e>onNext</span>(<span style=color:#e6db74>&#34;B&#34;</span>);
</span></span><span style=display:flex><span>    subscriber.<span style=color:#a6e22e>onNext</span>(<span style=color:#e6db74>&#34;C&#34;</span>);
</span></span><span style=display:flex><span>    subscriber.<span style=color:#a6e22e>onCompleted</span>();
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Observable<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> observable <span style=color:#f92672>=</span> Observable.<span style=color:#a6e22e>just</span>(<span style=color:#e6db74>&#34;A&#34;</span>, <span style=color:#e6db74>&#34;B&#34;</span>, <span style=color:#e6db74>&#34;C&#34;</span>);     快捷方式
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> Arrays.<span style=color:#a6e22e>asList</span>(<span style=color:#e6db74>&#34;A&#34;</span>, <span style=color:#e6db74>&#34;B&#34;</span>, <span style=color:#e6db74>&#34;C&#34;</span>);
</span></span><span style=display:flex><span>Observable<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> observable <span style=color:#f92672>=</span> Observable.<span style=color:#a6e22e>from</span>(list);     快捷方式
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>observable.<span style=color:#a6e22e>subscribe</span>(observer);     被观察者订阅观察者<span style=color:#960050;background-color:#1e0010>（</span>观察者见下文<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>A
</span></span><span style=display:flex><span>B
</span></span><span style=display:flex><span>C
</span></span><span style=display:flex><span>onCompleted
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Note<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>0. 被观察者发出事件<span style=color:#960050;background-color:#1e0010>，</span>观察者处理事件<span style=color:#960050;background-color:#1e0010>。（</span>可一对多<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>1. 一旦被观察者调用 <span style=color:#a6e22e>subscribe</span>() 方法订阅观察者<span style=color:#960050;background-color:#1e0010>，</span>被观察者中的唯一成员 OnSubscribe 将执行 <span style=color:#a6e22e>call</span>() 方法并将观察者作为参数传入<span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span>2. 调用 <span style=color:#a6e22e>subscribe</span>() 方法后会返回 Subscription 接口对象<span style=color:#960050;background-color:#1e0010>（</span>仅含 2 个方法 unsubscribe 和 isUnsubscribed<span style=color:#960050;background-color:#1e0010>），</span>代表被观察者与观察者之间的订阅关系<span style=color:#960050;background-color:#1e0010>。</span>
</span></span></code></pre></div><h2 id=observer---观察者>Observer - 观察者<a hidden class=anchor aria-hidden=true href=#observer---观察者>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Observer<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> observer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Observer<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>() {     接口<span style=color:#960050;background-color:#1e0010>（</span>最终会被包装为 Subscriber<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCompleted</span>() {     完成事件<span style=color:#960050;background-color:#1e0010>（</span>调用链结束<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;onCompleted&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onError</span>(Throwable e) {     出现异常<span style=color:#960050;background-color:#1e0010>，</span>框架自动调用<span style=color:#960050;background-color:#1e0010>（</span>调用链结束<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;onError&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onNext</span>(String s) {     处理事件
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(s);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Subscriber<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> subscriber <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Subscriber<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>() {     抽象类<span style=color:#960050;background-color:#1e0010>（</span>继承但未实现 Observer 接口<span style=color:#960050;background-color:#1e0010>，</span>且可选择性重写 onStart 方法<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCompleted</span>() {     完成事件<span style=color:#960050;background-color:#1e0010>（</span>调用链结束<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;onCompleted&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onError</span>(Throwable e) {     出现异常<span style=color:#960050;background-color:#1e0010>，</span>框架自动调用<span style=color:#960050;background-color:#1e0010>（</span>调用链结束<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;onError&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onNext</span>(String s) {     处理事件
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(s);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>调用链<span style=color:#960050;background-color:#1e0010>：</span>onStart() <span style=color:#f92672>--&gt;</span> onNext() <span style=color:#f92672>--&gt;</span> onCompleted()
</span></span><span style=display:flex><span>   <span style=color:#f92672>|</span>       <span style=color:#f92672>|</span>                   <span style=color:#960050;background-color:#1e0010>↳</span> onError()
</span></span><span style=display:flex><span>   <span style=color:#f92672>|</span>       <span style=color:#960050;background-color:#1e0010>↳</span> 此方法只能在调用 <span style=color:#a6e22e>subscribe</span>() 的线程上执行<span style=color:#960050;background-color:#1e0010>，</span>可通过操作符 <span style=color:#a6e22e>doOnSubscribe</span>(Action0) 替代且可指定运行线程
</span></span><span style=display:flex><span>   <span style=color:#960050;background-color:#1e0010>↳</span> 当调用链结束后<span style=color:#960050;background-color:#1e0010>，</span>订阅关系自动解除<span style=color:#960050;background-color:#1e0010>（</span>Subscription.<span style=color:#a6e22e>isUnsubscribed</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Action1<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> action1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Action1<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>() {     快捷方式<span style=color:#960050;background-color:#1e0010>（</span>被观察者的 <span style=color:#a6e22e>subscribe</span>() 方法支持传入 Action1 接口充当 onNext<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>call</span>(String s) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(s);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Action1<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> action1 <span style=color:#f92672>=</span> s <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(s);     简化为 Lambda 表达式
</span></span><span style=display:flex><span>Action1<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> action1 <span style=color:#f92672>=</span> System.<span style=color:#a6e22e>out</span>::println;     简化为方法引用
</span></span></code></pre></div><h2 id=scheduler---线程调度>Scheduler - 线程调度<a hidden class=anchor aria-hidden=true href=#scheduler---线程调度>#</a></h2><p>默认情况下调用链（事件流）在调用 subscribe() 的线程上运行，可以通过以下 2 种方法指定运行线程：</p><ul><li>（一次）<code>subscribeOn()</code>：指定其运行线程。</li><li>（多次）<code>observeOn()</code>：切换其运行线程。<ul><li><code>subscribeOn()</code> 用于指定最开始调用链（事件流）的运行线程，后期可通过 <code>observeOn()</code> 随时切换其运行线程。</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Observable
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>create</span>((Observable.<span style=color:#a6e22e>OnSubscribe</span><span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>) subscriber <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            Log.<span style=color:#a6e22e>w</span>(<span style=color:#e6db74>&#34;Tag&#34;</span>, <span style=color:#e6db74>&#34;create__&#34;</span> <span style=color:#f92672>+</span> Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>            subscriber.<span style=color:#a6e22e>onNext</span>(<span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>            subscriber.<span style=color:#a6e22e>onCompleted</span>();
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>observeOn</span>(Schedulers.<span style=color:#a6e22e>computation</span>())     切换至计算线程 (2)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>map</span>(s <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            Log.<span style=color:#a6e22e>w</span>(<span style=color:#e6db74>&#34;Tag&#34;</span>, <span style=color:#e6db74>&#34;map__&#34;</span> <span style=color:#f92672>+</span> Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> s;
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>observeOn</span>(AndroidSchedulers.<span style=color:#a6e22e>mainThread</span>())     切换至主线程 (3)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subscribeOn</span>(Schedulers.<span style=color:#a6e22e>io</span>())     指定最开始在IO线程中运行 (1)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subscribe</span>(<span style=color:#66d9ef>new</span> Subscriber<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>() {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCompleted</span>() {
</span></span><span style=display:flex><span>                Log.<span style=color:#a6e22e>w</span>(<span style=color:#e6db74>&#34;Tag&#34;</span>, <span style=color:#e6db74>&#34;onCompleted__&#34;</span> <span style=color:#f92672>+</span> Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onError</span>(Throwable e) {
</span></span><span style=display:flex><span>                Log.<span style=color:#a6e22e>w</span>(<span style=color:#e6db74>&#34;Tag&#34;</span>, <span style=color:#e6db74>&#34;onError&#34;</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onNext</span>(String s) {
</span></span><span style=display:flex><span>                Log.<span style=color:#a6e22e>w</span>(<span style=color:#e6db74>&#34;Tag&#34;</span>, <span style=color:#e6db74>&#34;onNext__&#34;</span> <span style=color:#f92672>+</span> Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>23701<span style=color:#f92672>-</span>14945<span style=color:#f92672>/</span>com.<span style=color:#a6e22e>example</span>.<span style=color:#a6e22e>myapp</span>.<span style=color:#a6e22e>myapplication</span> W<span style=color:#f92672>/</span>Tag: create__Thread<span style=color:#f92672>[</span>RxIoScheduler<span style=color:#f92672>-</span>3,5,main<span style=color:#f92672>]</span>     IO 线程
</span></span><span style=display:flex><span>23701<span style=color:#f92672>-</span>23824<span style=color:#f92672>/</span>com.<span style=color:#a6e22e>example</span>.<span style=color:#a6e22e>myapp</span>.<span style=color:#a6e22e>myapplication</span> W<span style=color:#f92672>/</span>Tag: map__Thread<span style=color:#f92672>[</span>RxComputationScheduler<span style=color:#f92672>-</span>2,5,main<span style=color:#f92672>]</span>     计算线程
</span></span><span style=display:flex><span>23701<span style=color:#f92672>-</span>23701<span style=color:#f92672>/</span>com.<span style=color:#a6e22e>example</span>.<span style=color:#a6e22e>myapp</span>.<span style=color:#a6e22e>myapplication</span> W<span style=color:#f92672>/</span>Tag: onNext__Thread<span style=color:#f92672>[</span>main,5,main<span style=color:#f92672>]</span>     主线程
</span></span><span style=display:flex><span>23701<span style=color:#f92672>-</span>23701<span style=color:#f92672>/</span>com.<span style=color:#a6e22e>example</span>.<span style=color:#a6e22e>myapp</span>.<span style=color:#a6e22e>myapplication</span> W<span style=color:#f92672>/</span>Tag: onCompleted__Thread<span style=color:#f92672>[</span>main,5,main<span style=color:#f92672>]</span>     主线程
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>实例<span style=color:#960050;background-color:#1e0010>：</span>加载网络图片
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>Observable
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>just</span>(<span style=color:#e6db74>&#34;http://blog.xhstormr.tk/uploads/children-of-the-sun1.jpg&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>map</span>(s <span style=color:#f92672>-&gt;</span> {     下载 Bitmap<span style=color:#960050;background-color:#1e0010>（</span>String <span style=color:#960050;background-color:#1e0010>➜</span> Bitmap<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>            Bitmap bitmap <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> (BufferedInputStream bufferedInputStream <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> BufferedInputStream(<span style=color:#66d9ef>new</span> URL(s).<span style=color:#a6e22e>openStream</span>())) {
</span></span><span style=display:flex><span>                bitmap <span style=color:#f92672>=</span> BitmapFactory.<span style=color:#a6e22e>decodeStream</span>(bufferedInputStream);
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>catch</span> (IOException e) {
</span></span><span style=display:flex><span>                e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> bitmap;
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>observeOn</span>(AndroidSchedulers.<span style=color:#a6e22e>mainThread</span>())     切换至主线程 (2)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subscribeOn</span>(Schedulers.<span style=color:#a6e22e>io</span>())     指定最开始在IO线程中运行 (1)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subscribe</span>(bitmap <span style=color:#f92672>-&gt;</span> mImageView.<span style=color:#a6e22e>setImageBitmap</span>(bitmap));     加载 Bitmap
</span></span></code></pre></div><h2 id=operators---操作符>Operators - 操作符<a hidden class=anchor aria-hidden=true href=#operators---操作符>#</a></h2><p>类似于 Java 8 中的 Stream 的内部迭代。</p><h3 id=转换>转换<a hidden class=anchor aria-hidden=true href=#转换>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>A</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> List<span style=color:#f92672>&lt;</span>Author<span style=color:#f92672>&gt;</span> LIST <span style=color:#f92672>=</span> Arrays.<span style=color:#a6e22e>asList</span>(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> Author(<span style=color:#e6db74>&#34;Adam&#34;</span>, 23, Arrays.<span style=color:#a6e22e>asList</span>(<span style=color:#e6db74>&#34;Java1&#34;</span>, <span style=color:#e6db74>&#34;Java2&#34;</span>)),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> Author(<span style=color:#e6db74>&#34;Bell&#34;</span>, 19, Arrays.<span style=color:#a6e22e>asList</span>(<span style=color:#e6db74>&#34;Python1&#34;</span>, <span style=color:#e6db74>&#34;Python2&#34;</span>)),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> Author(<span style=color:#e6db74>&#34;Conan&#34;</span>, 23, Arrays.<span style=color:#a6e22e>asList</span>(<span style=color:#e6db74>&#34;PHP1&#34;</span>, <span style=color:#e6db74>&#34;PHP2&#34;</span>)),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> Author(<span style=color:#e6db74>&#34;David&#34;</span>, 26, Arrays.<span style=color:#a6e22e>asList</span>(<span style=color:#e6db74>&#34;Ruby1&#34;</span>, <span style=color:#e6db74>&#34;Ruby2&#34;</span>)));     作家列表
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(LIST)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>map</span>(author <span style=color:#f92672>-&gt;</span> author.<span style=color:#a6e22e>mAge</span>)     一对一
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>sorted</span>()     排序
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(integer <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>print</span>(integer <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; &#34;</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;\n————————————&#34;</span>));
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(LIST)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>map</span>(author <span style=color:#f92672>-&gt;</span> author.<span style=color:#a6e22e>mAge</span>)     一对一
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>sorted</span>()     排序
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>scan</span>(0, (i1, i2) <span style=color:#f92672>-&gt;</span> i1 <span style=color:#f92672>+</span> i2)     累加器<span style=color:#960050;background-color:#1e0010>，</span>提供初始值
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(integer <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>print</span>(integer <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; &#34;</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;\n————————————&#34;</span>));
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(LIST)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>map</span>(author <span style=color:#f92672>-&gt;</span> author.<span style=color:#a6e22e>mAge</span>)     一对一
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>reduce</span>(0, (i1, i2) <span style=color:#f92672>-&gt;</span> i1 <span style=color:#f92672>+</span> i2)     累加器<span style=color:#960050;background-color:#1e0010>，</span>提供初始值
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(integer <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>print</span>(integer <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; &#34;</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;\n————————————&#34;</span>));
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(LIST)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>flatMap</span>(author <span style=color:#f92672>-&gt;</span> Observable.<span style=color:#a6e22e>from</span>(author.<span style=color:#a6e22e>mArticle</span>))     一对多<span style=color:#960050;background-color:#1e0010>（</span>手动转换为 Observable<span style=color:#960050;background-color:#1e0010>）（</span>推荐使用 concatMap<span style=color:#960050;background-color:#1e0010>，</span>解决 flatMap 事件交叉问题<span style=color:#960050;background-color:#1e0010>）（</span>flatMap() 底层调用 <span style=color:#a6e22e>merge</span>()<span style=color:#960050;background-color:#1e0010>，</span>concatMap 底层调用 <span style=color:#a6e22e>concat</span>()<span style=color:#960050;background-color:#1e0010>，</span>下同<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;————————————&#34;</span>));
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(LIST)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>flatMapIterable</span>(author <span style=color:#f92672>-&gt;</span> author.<span style=color:#a6e22e>mArticle</span>)     一对多<span style=color:#960050;background-color:#1e0010>（</span>自动转换为 Observable<span style=color:#960050;background-color:#1e0010>）（</span>推荐使用 concatMapIterable<span style=color:#960050;background-color:#1e0010>，</span>解决 flatMapIterable 事件交叉问题<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;————————————&#34;</span>));
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(LIST)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>groupBy</span>(author <span style=color:#f92672>-&gt;</span> author.<span style=color:#a6e22e>mAge</span>)     按年龄将事件流分组
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>concatMap</span>(groupedObservable <span style=color:#f92672>-&gt;</span> groupedObservable)     一对多
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(author <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;年龄:%d 姓名:%s\n&#34;</span>, author.<span style=color:#a6e22e>mAge</span>, author.<span style=color:#a6e22e>mName</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;————————————&#34;</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Author</span> {     作家
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String mName;     姓名
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> mAge;     年龄
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> mArticle;     文章列表
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Author</span>(String name, <span style=color:#66d9ef>int</span> age, List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> article) {
</span></span><span style=display:flex><span>            mName <span style=color:#f92672>=</span> name;
</span></span><span style=display:flex><span>            mAge <span style=color:#f92672>=</span> age;
</span></span><span style=display:flex><span>            mArticle <span style=color:#f92672>=</span> article;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>toString</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> mName;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>19 23 23 26
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>0 19 42 65 91
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>91
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>Java1
</span></span><span style=display:flex><span>Java2
</span></span><span style=display:flex><span>Python1
</span></span><span style=display:flex><span>Python2
</span></span><span style=display:flex><span>PHP1
</span></span><span style=display:flex><span>PHP2
</span></span><span style=display:flex><span>Ruby1
</span></span><span style=display:flex><span>Ruby2
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>Java1
</span></span><span style=display:flex><span>Java2
</span></span><span style=display:flex><span>Python1
</span></span><span style=display:flex><span>Python2
</span></span><span style=display:flex><span>PHP1
</span></span><span style=display:flex><span>PHP2
</span></span><span style=display:flex><span>Ruby1
</span></span><span style=display:flex><span>Ruby2
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>年龄:23 姓名:Adam
</span></span><span style=display:flex><span>年龄:23 姓名:Conan
</span></span><span style=display:flex><span>年龄:19 姓名:Bell
</span></span><span style=display:flex><span>年龄:26 姓名:David
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span></code></pre></div><h3 id=过滤>过滤<a hidden class=anchor aria-hidden=true href=#过滤>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>A</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> List<span style=color:#f92672>&lt;</span>Author<span style=color:#f92672>&gt;</span> LIST <span style=color:#f92672>=</span> Arrays.<span style=color:#a6e22e>asList</span>(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> Author(<span style=color:#e6db74>&#34;Adam&#34;</span>, 23, Arrays.<span style=color:#a6e22e>asList</span>(<span style=color:#e6db74>&#34;Java1&#34;</span>, <span style=color:#e6db74>&#34;Java2&#34;</span>)),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> Author(<span style=color:#e6db74>&#34;Bell&#34;</span>, 19, Arrays.<span style=color:#a6e22e>asList</span>(<span style=color:#e6db74>&#34;Python1&#34;</span>, <span style=color:#e6db74>&#34;Python2&#34;</span>)),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> Author(<span style=color:#e6db74>&#34;Conan&#34;</span>, 23, Arrays.<span style=color:#a6e22e>asList</span>(<span style=color:#e6db74>&#34;PHP1&#34;</span>, <span style=color:#e6db74>&#34;PHP2&#34;</span>)),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> Author(<span style=color:#e6db74>&#34;David&#34;</span>, 26, Arrays.<span style=color:#a6e22e>asList</span>(<span style=color:#e6db74>&#34;Ruby1&#34;</span>, <span style=color:#e6db74>&#34;Ruby2&#34;</span>)));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(LIST)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>filter</span>(author <span style=color:#f92672>-&gt;</span> author.<span style=color:#a6e22e>mAge</span> <span style=color:#f92672>&gt;</span> 25)     过滤
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(author <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;年龄:%d 姓名:%s\n&#34;</span>, author.<span style=color:#a6e22e>mAge</span>, author.<span style=color:#a6e22e>mName</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;————————————&#34;</span>));
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(LIST)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>take</span>(2)     只取前 2
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;————————————&#34;</span>));
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(LIST)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>takeLast</span>(2)     只取后 2
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;————————————&#34;</span>));
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(LIST)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>skip</span>(2)     跳过前 2
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;————————————&#34;</span>));
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(LIST)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>skipLast</span>(2)     跳过后 2
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;————————————&#34;</span>));
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(LIST)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>elementAt</span>(0)     选取
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;————————————&#34;</span>));
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(LIST)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>first</span>()     选取最前<span style=color:#960050;background-color:#1e0010>（</span>若无数据<span style=color:#960050;background-color:#1e0010>：</span>first() 直接调用 <span style=color:#a6e22e>onError</span>()<span style=color:#960050;background-color:#1e0010>，</span>takeFirst() 直接调用 <span style=color:#a6e22e>onCompleted</span>()<span style=color:#960050;background-color:#1e0010>，</span>下同<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;————————————&#34;</span>));
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(LIST)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>last</span>()     选取最后
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;————————————&#34;</span>));
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(Arrays.<span style=color:#a6e22e>asList</span>(1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 1, 2, 3, 4, 5, 6))
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>distinct</span>()     去重
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(integer <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>print</span>(integer <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; &#34;</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;\n————————————&#34;</span>));
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(Arrays.<span style=color:#a6e22e>asList</span>(1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 1, 2, 3, 4, 5, 6))
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>distinctUntilChanged</span>()     前后去重
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(integer <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>print</span>(integer <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; &#34;</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;\n————————————&#34;</span>));
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>        年龄:26 姓名:David
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>        Adam
</span></span><span style=display:flex><span>        Bell
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>        Conan
</span></span><span style=display:flex><span>        David
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>        Conan
</span></span><span style=display:flex><span>        David
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>        Adam
</span></span><span style=display:flex><span>        Bell
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>        Adam
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>        Adam
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>        David
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>        1 2 3 4 5 6
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>        1 2 3 4 5 6 1 2 3 4 5 6
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>————————————</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>a</span>() <span style=color:#66d9ef>throws</span> InterruptedException {     takeUntil
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>from</span>(Arrays.<span style=color:#a6e22e>asList</span>(1, 2, 3, 4, 5, 6))
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>takeUntil</span>(integer <span style=color:#f92672>-&gt;</span> integer <span style=color:#f92672>==</span> 3)     一直处理事件<span style=color:#960050;background-color:#1e0010>，</span>直到事件符合某项条件
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println);
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>        1
</span></span><span style=display:flex><span>        2
</span></span><span style=display:flex><span>        3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Observable<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>&gt;</span> observable1 <span style=color:#f92672>=</span> Observable.<span style=color:#a6e22e>interval</span>(300, TimeUnit.<span style=color:#a6e22e>MILLISECONDS</span>);     每隔 300 毫秒发送数字
</span></span><span style=display:flex><span>        Observable<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>&gt;</span> observable2 <span style=color:#f92672>=</span> Observable.<span style=color:#a6e22e>interval</span>(800, TimeUnit.<span style=color:#a6e22e>MILLISECONDS</span>);     每隔 800 毫秒发送数字
</span></span><span style=display:flex><span>        observable1
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>takeUntil</span>(observable2)     一直处理事件<span style=color:#960050;background-color:#1e0010>，</span>直到 observable2 发送了事件
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>        Thread.<span style=color:#a6e22e>sleep</span>(Integer.<span style=color:#a6e22e>MAX_VALUE</span>);
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>        0
</span></span><span style=display:flex><span>        1
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Author</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String mName;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> mAge;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> mArticle;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Author</span>(String name, <span style=color:#66d9ef>int</span> age, List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> article) {
</span></span><span style=display:flex><span>            mName <span style=color:#f92672>=</span> name;
</span></span><span style=display:flex><span>            mAge <span style=color:#f92672>=</span> age;
</span></span><span style=display:flex><span>            mArticle <span style=color:#f92672>=</span> article;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>toString</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> mName;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=组合>组合<a hidden class=anchor aria-hidden=true href=#组合>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>A</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String<span style=color:#f92672>[]</span> strings <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;A&#34;</span>, <span style=color:#e6db74>&#34;B&#34;</span>, <span style=color:#e6db74>&#34;C&#34;</span>, <span style=color:#e6db74>&#34;D&#34;</span>, <span style=color:#e6db74>&#34;E&#34;</span>};
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Observable<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> observable1 <span style=color:#f92672>=</span> Observable     每隔 300 毫秒发送事件<span style=color:#960050;background-color:#1e0010>：</span>A B C D E
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>interval</span>(300, TimeUnit.<span style=color:#a6e22e>MILLISECONDS</span>)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>take</span>(strings.<span style=color:#a6e22e>length</span>)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>map</span>(aLong <span style=color:#f92672>-&gt;</span> strings<span style=color:#f92672>[</span>aLong.<span style=color:#a6e22e>intValue</span>()<span style=color:#f92672>]</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Observable<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>&gt;</span> observable2 <span style=color:#f92672>=</span> Observable     每隔 500 毫秒发送事件<span style=color:#960050;background-color:#1e0010>：</span>0 1 2 3 4 5 6 7 8 9
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>interval</span>(500, TimeUnit.<span style=color:#a6e22e>MILLISECONDS</span>)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>take</span>(10);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> InterruptedException {
</span></span><span style=display:flex><span>        a();
</span></span><span style=display:flex><span>        b();
</span></span><span style=display:flex><span>        Thread.<span style=color:#a6e22e>sleep</span>(Integer.<span style=color:#a6e22e>MAX_VALUE</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>a</span>() {     合并
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>merge</span>(observable1, observable2)     无序合并<span style=color:#960050;background-color:#1e0010>（</span>异步进行<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(o <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>print</span>(o <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; &#34;</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>        A 0 B C 1 D E 2 3 4 5 6 7 8 9
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>concat</span>(observable1, observable2)     有序合并<span style=color:#960050;background-color:#1e0010>（</span>同步进行<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(o <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>print</span>(o <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; &#34;</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>        A B C D E 0 1 2 3 4 5 6 7 8 9
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        observable1
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>startWith</span>(Observable.<span style=color:#a6e22e>just</span>(<span style=color:#e6db74>&#34;AA&#34;</span>, <span style=color:#e6db74>&#34;BB&#34;</span>, <span style=color:#e6db74>&#34;CC&#34;</span>))     有序合并<span style=color:#960050;background-color:#1e0010>（</span>同步进行<span style=color:#960050;background-color:#1e0010>），</span>底层调用 concat 在其之前插入新事件<span style=color:#960050;background-color:#1e0010>，</span>接收 Observable 和 Iterable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(o <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>print</span>(o <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; &#34;</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>        AA BB CC A B C D E
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>b</span>() {     组合
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>zip</span>(observable1, observable2, (s, aLong) <span style=color:#f92672>-&gt;</span> s <span style=color:#f92672>+</span> aLong)     不可重用
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(o <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>print</span>(o <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; &#34;</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>        A0 B1 C2 D3 E4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>combineLatest</span>(observable1, observable2, (s, aLong) <span style=color:#f92672>-&gt;</span> s <span style=color:#f92672>+</span> aLong)     可重用<span style=color:#960050;background-color:#1e0010>（</span>与最近的事件组合<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(o <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>print</span>(o <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; &#34;</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>        A0 B0 C0 C1 D1 E1 E2 E3 E4 E5 E6 E7 E8 E9
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        observable1     左事件源
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>join</span>(     可重用<span style=color:#960050;background-color:#1e0010>（</span>事件具有有效期<span style=color:#960050;background-color:#1e0010>，</span>有点像排列组合<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>                        observable2,     右事件源
</span></span><span style=display:flex><span>                        s <span style=color:#f92672>-&gt;</span> Observable.<span style=color:#a6e22e>timer</span>(10000, TimeUnit.<span style=color:#a6e22e>MILLISECONDS</span>),     左事件有效期
</span></span><span style=display:flex><span>                        aLong <span style=color:#f92672>-&gt;</span> Observable.<span style=color:#a6e22e>timer</span>(0, TimeUnit.<span style=color:#a6e22e>MILLISECONDS</span>),     右事件有效期
</span></span><span style=display:flex><span>                        (s, aLong) <span style=color:#f92672>-&gt;</span> s <span style=color:#f92672>+</span> aLong)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(o <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>print</span>(o <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; &#34;</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>        A0 A1 B1 C1 A2 B2 C2 D2 E2 A3 B3 C3 D3 E3 A4 B4 C4 D4 E4 A5 B5 C5 D5 E5 A6 B6 C6 D6 E6 A7 B7 C7 D7 E7 A8 B8 C8 D8 E8 A9 B9 C9 D9 E9
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=code>Code<a hidden class=anchor aria-hidden=true href=#code>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Observable
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>just</span>(<span style=color:#e6db74>&#34;A&#34;</span>, <span style=color:#e6db74>&#34;B&#34;</span>, <span style=color:#e6db74>&#34;C&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>doOnNext</span>(s <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%s__%s__%s\n&#34;</span>, s, Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>getName</span>(), <span style=color:#e6db74>&#34;doOnNext&#34;</span>))     类似于 Java 8 中的 Stream 的 peek
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>map</span>(s <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%s__%s__%s\n&#34;</span>, s, Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>getName</span>(), <span style=color:#e6db74>&#34;map&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> s;
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subscribe</span>(s <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%s__%s__%s\n&#34;</span>, s, Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>getName</span>(), <span style=color:#e6db74>&#34;onNext&#34;</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>Thread.<span style=color:#a6e22e>sleep</span>(Integer.<span style=color:#a6e22e>MAX_VALUE</span>);
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>输出<span style=color:#960050;background-color:#1e0010>：</span>     类似于 Java 8 中的 Stream 的垂直执行<span style=color:#960050;background-color:#1e0010>，</span>像在流水线依次经过每个操作<span style=color:#960050;background-color:#1e0010>，</span>并通过短路求值尽可能减少操作次数
</span></span><span style=display:flex><span>A__main__doOnNext
</span></span><span style=display:flex><span>A__main__map
</span></span><span style=display:flex><span>A__main__onNext
</span></span><span style=display:flex><span>B__main__doOnNext
</span></span><span style=display:flex><span>B__main__map
</span></span><span style=display:flex><span>B__main__onNext
</span></span><span style=display:flex><span>C__main__doOnNext
</span></span><span style=display:flex><span>C__main__map
</span></span><span style=display:flex><span>C__main__onNext
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Observable
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>just</span>(<span style=color:#e6db74>&#34;A&#34;</span>, <span style=color:#e6db74>&#34;B&#34;</span>, <span style=color:#e6db74>&#34;C&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>doOnNext</span>(s <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%s__%s__%s\n&#34;</span>, s, Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>getName</span>(), <span style=color:#e6db74>&#34;doOnNext&#34;</span>))
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>map</span>(s <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%s__%s__%s\n&#34;</span>, s, Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>getName</span>(), <span style=color:#e6db74>&#34;map&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> s;
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>observeOn</span>(Schedulers.<span style=color:#a6e22e>computation</span>())     切换至计算线程 (2)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subscribeOn</span>(Schedulers.<span style=color:#a6e22e>io</span>())     指定最开始在IO线程中运行 (1)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subscribe</span>(s <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%s__%s__%s\n&#34;</span>, s, Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>getName</span>(), <span style=color:#e6db74>&#34;onNext&#34;</span>), System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>Thread.<span style=color:#a6e22e>sleep</span>(Integer.<span style=color:#a6e22e>MAX_VALUE</span>);
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>A__RxIoScheduler<span style=color:#f92672>-</span>2__doOnNext
</span></span><span style=display:flex><span>A__RxIoScheduler<span style=color:#f92672>-</span>2__map
</span></span><span style=display:flex><span>B__RxIoScheduler<span style=color:#f92672>-</span>2__doOnNext
</span></span><span style=display:flex><span>B__RxIoScheduler<span style=color:#f92672>-</span>2__map
</span></span><span style=display:flex><span>C__RxIoScheduler<span style=color:#f92672>-</span>2__doOnNext
</span></span><span style=display:flex><span>C__RxIoScheduler<span style=color:#f92672>-</span>2__map
</span></span><span style=display:flex><span>A__RxComputationScheduler<span style=color:#f92672>-</span>1__onNext
</span></span><span style=display:flex><span>B__RxComputationScheduler<span style=color:#f92672>-</span>1__onNext
</span></span><span style=display:flex><span>C__RxComputationScheduler<span style=color:#f92672>-</span>1__onNext
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>通过 <span style=color:#a6e22e>compose</span>() 操作符重用操作链
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------------------</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>A</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> Observable.<span style=color:#a6e22e>Transformer</span><span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;</span> transformer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Observable.<span style=color:#a6e22e>Transformer</span><span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;</span>() {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> Observable<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>call</span>(Observable<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> stringObservable) {     对传入的原始被观察者进行加工
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> stringObservable.<span style=color:#a6e22e>doOnUnsubscribe</span>(() <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Unsubscribed&#34;</span>)).<span style=color:#a6e22e>map</span>(s <span style=color:#f92672>-&gt;</span> s <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;1&#34;</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        };     Transformer 对象
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>just</span>(<span style=color:#e6db74>&#34;A&#34;</span>, <span style=color:#e6db74>&#34;B&#34;</span>, <span style=color:#e6db74>&#34;C&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>compose</span>(transformer)     重用 Transformer
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println);
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>just</span>(<span style=color:#e6db74>&#34;1&#34;</span>, <span style=color:#e6db74>&#34;2&#34;</span>, <span style=color:#e6db74>&#34;3&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>compose</span>(transformer)     重用 Transformer
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>A1
</span></span><span style=display:flex><span>B1
</span></span><span style=display:flex><span>C1
</span></span><span style=display:flex><span>Unsubscribed
</span></span><span style=display:flex><span>11
</span></span><span style=display:flex><span>21
</span></span><span style=display:flex><span>31
</span></span><span style=display:flex><span>Unsubscribed
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Note<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>1. <span style=color:#a6e22e>compose</span>() 接收一个 Transformer 接口<span style=color:#960050;background-color:#1e0010>，</span>此接口继承自 Func1<span style=color:#960050;background-color:#1e0010>，</span>接收原始 Observable<span style=color:#960050;background-color:#1e0010>，</span>返回新 Observable<span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span>2. <span style=color:#a6e22e>compose</span>() 作用于整个被观察者<span style=color:#960050;background-color:#1e0010>，</span>flatMap() 作用于每个事件<span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>实例<span style=color:#960050;background-color:#1e0010>：</span>改进之前线程调度加载网络图片的例子
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>A</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> Observable.<span style=color:#a6e22e>Transformer</span><span style=color:#f92672>&lt;</span>Object, Object<span style=color:#f92672>&gt;</span> mTransformer <span style=color:#f92672>=</span> observable <span style=color:#f92672>-&gt;</span>     单例模式
</span></span><span style=display:flex><span>            observable
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>observeOn</span>(AndroidSchedulers.<span style=color:#a6e22e>mainThread</span>())     切换至主线程 (2)
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>subscribeOn</span>(Schedulers.<span style=color:#a6e22e>io</span>());     指定最开始在IO线程中运行 (1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unchecked&#34;</span>)     压制警告<span style=color:#960050;background-color:#1e0010>（</span>强制类型转换<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> Observable.<span style=color:#a6e22e>Transformer</span><span style=color:#f92672>&lt;</span>T, T<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>applySchedulers</span>() {
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>return</span> ((Observable.<span style=color:#a6e22e>Transformer</span><span style=color:#f92672>&lt;</span>T, T<span style=color:#f92672>&gt;</span>) mTransformer);   返回 Transformer 对象<span style=color:#960050;background-color:#1e0010>（</span>为了不丢失类型信息而强制转换<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Observable
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>just</span>(<span style=color:#e6db74>&#34;http://blog.xhstormr.tk/uploads/children-of-the-sun1.jpg&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>map</span>(s <span style=color:#f92672>-&gt;</span> {     下载 Bitmap<span style=color:#960050;background-color:#1e0010>（</span>String <span style=color:#960050;background-color:#1e0010>➜</span> Bitmap<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>            Bitmap bitmap <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> (BufferedInputStream bufferedInputStream <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> BufferedInputStream(<span style=color:#66d9ef>new</span> URL(s).<span style=color:#a6e22e>openStream</span>())) {
</span></span><span style=display:flex><span>                bitmap <span style=color:#f92672>=</span> BitmapFactory.<span style=color:#a6e22e>decodeStream</span>(bufferedInputStream);
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>catch</span> (IOException e) {
</span></span><span style=display:flex><span>                e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> bitmap;
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>compose</span>(A.<span style=color:#a6e22e>applySchedulers</span>())     只需传入 A.<span style=color:#a6e22e>applySchedulers</span>() 返回的对象<span style=color:#960050;background-color:#1e0010>，</span>即可后台处理<span style=color:#960050;background-color:#1e0010>，</span>前台显示
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>subscribe</span>(bitmap <span style=color:#f92672>-&gt;</span> mImageView.<span style=color:#a6e22e>setImageBitmap</span>(bitmap));     加载 Bitmap
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>通过 Observable.<span style=color:#a6e22e>defer</span>(Func0) 实现延迟订阅
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------------------</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>A</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String s;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        Observable<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> observable <span style=color:#f92672>=</span> Observable.<span style=color:#a6e22e>just</span>(s);     直接执行
</span></span><span style=display:flex><span>        s <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ABC&#34;</span>;
</span></span><span style=display:flex><span>        observable.<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println);
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Observable<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> observable <span style=color:#f92672>=</span> Observable.<span style=color:#a6e22e>defer</span>(() <span style=color:#f92672>-&gt;</span> Observable.<span style=color:#a6e22e>just</span>(s));     Func0 接口中的代码将延迟执行
</span></span><span style=display:flex><span>        s <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ABC&#34;</span>;
</span></span><span style=display:flex><span>        observable.<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println);
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>        ABC
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Note<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>0. <span style=color:#a6e22e>just</span>() 和 <span style=color:#a6e22e>from</span>() 在创建 Observable 时就存储了对象的值<span style=color:#960050;background-color:#1e0010>，</span>而 <span style=color:#a6e22e>create</span>() 创建的 Observable 在 <span style=color:#a6e22e>subscribe</span>() 时才访问对象<span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span>1. <span style=color:#a6e22e>defer</span>() 接收一个 Func0 接口并显式声明此接口返回一个 Observable 对象<span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span>2. <span style=color:#a6e22e>defer</span>() 中的代码直到订阅才会执行<span style=color:#960050;background-color:#1e0010>。</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>通过 Schedulers 将耗时操作放到后台线程中执行
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------------------</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>A</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> InterruptedException {
</span></span><span style=display:flex><span>        Schedulers.<span style=color:#a6e22e>io</span>().<span style=color:#a6e22e>createWorker</span>().<span style=color:#a6e22e>schedule</span>(() <span style=color:#f92672>-&gt;</span> {     Action0 接口中的代码将在 IO 线程中执行
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(Thread.<span style=color:#a6e22e>currentThread</span>());
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>exit</span>(0);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>        Thread.<span style=color:#a6e22e>sleep</span>(Integer.<span style=color:#a6e22e>MAX_VALUE</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>Thread<span style=color:#f92672>[</span>RxIoScheduler<span style=color:#f92672>-</span>2,5,main<span style=color:#f92672>]</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Single
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>被观察者
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>Single<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> observable <span style=color:#f92672>=</span> Single.<span style=color:#a6e22e>create</span>(<span style=color:#66d9ef>new</span> Single.<span style=color:#a6e22e>OnSubscribe</span><span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>call</span>(SingleSubscriber<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>super</span> String<span style=color:#f92672>&gt;</span> singleSubscriber) {
</span></span><span style=display:flex><span>        singleSubscriber.<span style=color:#a6e22e>onSuccess</span>(<span style=color:#e6db74>&#34;A&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Single<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> observable <span style=color:#f92672>=</span> Single.<span style=color:#a6e22e>just</span>(<span style=color:#e6db74>&#34;A&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>观察者
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>SingleSubscriber<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> subscriber <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SingleSubscriber<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>() {     SingleSubscriber
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onSuccess</span>(String value) {     成功
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(value);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onError</span>(Throwable error) {     异常
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(error.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>实例
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>Single.<span style=color:#a6e22e>just</span>(<span style=color:#e6db74>&#34;A&#34;</span>).<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println);
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>A
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>延时执行
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------------------</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>A</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> InterruptedException {
</span></span><span style=display:flex><span>        Observable<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> range <span style=color:#f92672>=</span> Observable.<span style=color:#a6e22e>range</span>(0, 3);
</span></span><span style=display:flex><span>        range
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>delay</span>(2, TimeUnit.<span style=color:#a6e22e>SECONDS</span>)     2 秒
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>        Thread.<span style=color:#a6e22e>sleep</span>(Integer.<span style=color:#a6e22e>MAX_VALUE</span>);
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：（</span>延时 2 秒后执行<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>        0
</span></span><span style=display:flex><span>        1
</span></span><span style=display:flex><span>        2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Observable<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>&gt;</span> timer <span style=color:#f92672>=</span> Observable.<span style=color:#a6e22e>timer</span>(2, TimeUnit.<span style=color:#a6e22e>SECONDS</span>);    2 秒<span style=color:#960050;background-color:#1e0010>（</span>timer 操作返回计时器 Observable<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>        timer
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>delay</span>(2, TimeUnit.<span style=color:#a6e22e>SECONDS</span>)     2 秒
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>        Thread.<span style=color:#a6e22e>sleep</span>(Integer.<span style=color:#a6e22e>MAX_VALUE</span>);
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：（</span>延时 4 秒后执行<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>        0
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>缓解 Backpressure<span style=color:#960050;background-color:#1e0010>（</span>背部压力<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span><span style=color:#f92672>-------------------------------------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>缓冲事件
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>A</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> InterruptedException {
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>range</span>(0, 10)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>buffer</span>(2)     将多个事件包装为 List<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span><span style=color:#960050;background-color:#1e0010>，</span>缓冲区大小为 2
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println);
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span>0, 1<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span>2, 3<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span>4, 5<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span>6, 7<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span>8, 9<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>range</span>(0, 10)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>buffer</span>(2, 3)     将多个事件包装为 List<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span><span style=color:#960050;background-color:#1e0010>，</span>缓冲区大小为 2<span style=color:#960050;background-color:#1e0010>，</span>每次都跳过第 3 个事件
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println);
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span>0, 1<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span>3, 4<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span>6, 7<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[</span>9<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>过滤事件
</span></span><span style=display:flex><span><span style=color:#f92672>----</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>A</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> InterruptedException {
</span></span><span style=display:flex><span>        Observable<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>&gt;</span> timer <span style=color:#f92672>=</span> Observable.<span style=color:#a6e22e>timer</span>(5, TimeUnit.<span style=color:#a6e22e>SECONDS</span>);     5 秒后发出事件<span style=color:#960050;background-color:#1e0010>（</span>计时器<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>interval</span>(500, TimeUnit.<span style=color:#a6e22e>MILLISECONDS</span>)     每隔 500 毫秒发出事件
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>takeUntil</span>(timer)     一直处理事件<span style=color:#960050;background-color:#1e0010>，</span>直到 timer 发送了事件
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>        Thread.<span style=color:#a6e22e>sleep</span>(Integer.<span style=color:#a6e22e>MAX_VALUE</span>);
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：（</span>CPU 时间不准<span style=color:#960050;background-color:#1e0010>，</span>无过滤<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>        0
</span></span><span style=display:flex><span>        1
</span></span><span style=display:flex><span>        2
</span></span><span style=display:flex><span>        3
</span></span><span style=display:flex><span>        4
</span></span><span style=display:flex><span>        5
</span></span><span style=display:flex><span>        6
</span></span><span style=display:flex><span>        7
</span></span><span style=display:flex><span>        8
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>interval</span>(500, TimeUnit.<span style=color:#a6e22e>MILLISECONDS</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>takeUntil</span>(timer)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>throttleFirst</span>(1, TimeUnit.<span style=color:#a6e22e>SECONDS</span>)     每隔 1 秒发出时间段中的第一个事件
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>        Thread.<span style=color:#a6e22e>sleep</span>(Integer.<span style=color:#a6e22e>MAX_VALUE</span>);
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：（</span>CPU 时间不准<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>        0
</span></span><span style=display:flex><span>        3
</span></span><span style=display:flex><span>        5
</span></span><span style=display:flex><span>        7
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Observable
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>interval</span>(500, TimeUnit.<span style=color:#a6e22e>MILLISECONDS</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>takeUntil</span>(timer)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>throttleLast</span>(1, TimeUnit.<span style=color:#a6e22e>SECONDS</span>)     每隔 1 秒发出时间段中的最后一个事件<span style=color:#960050;background-color:#1e0010>（</span>跟 <span style=color:#a6e22e>sample</span>() 行为一致<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>        Thread.<span style=color:#a6e22e>sleep</span>(Integer.<span style=color:#a6e22e>MAX_VALUE</span>);
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：（</span>CPU 时间不准<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>        0
</span></span><span style=display:flex><span>        2
</span></span><span style=display:flex><span>        4
</span></span><span style=display:flex><span>        6
</span></span><span style=display:flex><span>        8
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Observable     debounce<span style=color:#960050;background-color:#1e0010>（</span>去抖<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>interval</span>(500, TimeUnit.<span style=color:#a6e22e>MILLISECONDS</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>takeUntil</span>(timer)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>debounce</span>(1, TimeUnit.<span style=color:#a6e22e>SECONDS</span>)     1 秒无新事件后<span style=color:#960050;background-color:#1e0010>，</span>再发送其接收到的最后一个事件
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>subscribe</span>(System.<span style=color:#a6e22e>out</span>::println, System.<span style=color:#a6e22e>out</span>::println, () <span style=color:#f92672>-&gt;</span> System.<span style=color:#a6e22e>exit</span>(0));
</span></span><span style=display:flex><span>        Thread.<span style=color:#a6e22e>sleep</span>(Integer.<span style=color:#a6e22e>MAX_VALUE</span>);
</span></span><span style=display:flex><span>        <span style=color:#f92672>----</span>
</span></span><span style=display:flex><span>        输出<span style=color:#960050;background-color:#1e0010>：（</span>CPU 时间不准<span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>        8
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://xhstormr.github.io/blog/tags/java/>JAVA</a></li></ul><nav class=paginav><a class=prev href=https://xhstormr.github.io/blog/posts/android-jsonutil/><span class=title>« Prev</span><br><span>JsonUtil</span>
</a><a class=next href=https://xhstormr.github.io/blog/posts/android-retrolambda/><span class=title>Next »</span><br><span>Retrolambda</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share RxJava on x" href="https://x.com/intent/tweet/?text=RxJava&amp;url=https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fjava-rxjava%2f&amp;hashtags=JAVA"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share RxJava on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fjava-rxjava%2f&amp;title=RxJava&amp;summary=RxJava&amp;source=https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fjava-rxjava%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share RxJava on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fjava-rxjava%2f&title=RxJava"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share RxJava on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fjava-rxjava%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share RxJava on whatsapp" href="https://api.whatsapp.com/send?text=RxJava%20-%20https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fjava-rxjava%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share RxJava on telegram" href="https://telegram.me/share/url?text=RxJava&amp;url=https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fjava-rxjava%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share RxJava on ycombinator" href="https://news.ycombinator.com/submitlink?t=RxJava&u=https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fjava-rxjava%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://xhstormr.github.io/blog/>XhstormR</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>