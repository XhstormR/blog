<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SQL 必知必会 | XhstormR</title><meta name=keywords content="SQL"><meta name=description content="SQL 必知必会 - XhstormR"><meta name=author content="XhstormR"><link rel=canonical href=https://xhstormr.github.io/blog/posts/sql/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.a090830a421002426baafbd314e38f149d77b4c48a12ee9312700d770b27fb26.css integrity="sha256-oJCDCkIQAkJrqvvTFOOPFJ13tMSKEu6TEnANdwsn+yY=" rel="preload stylesheet" as=style><link rel=icon href=https://xhstormr.github.io/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://xhstormr.github.io/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://xhstormr.github.io/blog/favicon-32x32.png><link rel=apple-touch-icon href=https://xhstormr.github.io/blog/apple-touch-icon.png><link rel=mask-icon href=https://xhstormr.github.io/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://xhstormr.github.io/blog/posts/sql/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://xhstormr.github.io/blog/posts/sql/"><meta property="og:site_name" content="XhstormR"><meta property="og:title" content="SQL 必知必会"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-04-07T15:05:01+08:00"><meta property="article:modified_time" content="2018-04-07T15:05:01+08:00"><meta property="article:tag" content="SQL"><meta name=twitter:card content="summary"><meta name=twitter:title content="SQL 必知必会"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://xhstormr.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"SQL 必知必会","item":"https://xhstormr.github.io/blog/posts/sql/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SQL 必知必会","name":"SQL 必知必会","description":"","keywords":["SQL"],"articleBody":"Updated on 2018-04-14\nhttps://zh.m.wikipedia.org/zh-cn/SQL\n/*2 检索*/ SELECT * FROM Products; SELECT prod_name FROM Products; -- DISTINCT 去重，作用于所有列 SELECT DISTINCT vend_id FROM Products; -- LIMIT 限制数量，OFFSET 偏移数量 SELECT prod_name FROM Products LIMIT 5 OFFSET 5; /*3 排序*/ -- ORDER BY 排序 SELECT prod_name FROM Products ORDER BY prod_name; -- 按多个列排序 SELECT prod_id, prod_price, prod_name FROM Products ORDER BY prod_price, prod_name; -- 等同于 SELECT prod_id, prod_price, prod_name FROM Products ORDER BY 2, 3; -- DESC 降序排序（缺省为升序 ASC） SELECT prod_id, prod_price, prod_name FROM Products ORDER BY prod_price DESC, prod_name; /*4 过滤*/ -- 检查单个值 SELECT prod_name, prod_price FROM Products WHERE prod_price = 3.49; SELECT prod_name, prod_price FROM Products WHERE prod_price \u003c= 10; -- 不匹配检查 SELECT vend_id, prod_name FROM Products WHERE vend_id != 'DLL01'; -- 范围值检查 SELECT prod_name, prod_price FROM Products WHERE prod_price BETWEEN 5 AND 10; -- 空值检查 SELECT cust_name FROM CUSTOMERS WHERE cust_email IS NULL; /*5 高级过滤*/ -- AND 且 SELECT prod_name, prod_price FROM Products WHERE vend_id = 'DLL01' AND prod_price \u003c= 4; -- OR 或 SELECT prod_name, prod_price FROM Products WHERE vend_id = 'DLL01' OR vend_id = 'BRS01'; -- NOT 非，条件取反，可以否定（取反）任何条件 SELECT prod_name, prod_price FROM Products WHERE NOT vend_id = 'FNG01'; -- IN 条件范围，与 OR 功能相当，推荐使用 SELECT prod_name, prod_price FROM Products WHERE vend_id IN ('DLL01', 'BRS01'); -- () 条件组合，管理比较顺序 SELECT prod_name, prod_price FROM Products WHERE (vend_id = 'DLL01' OR vend_id = 'BRS01') AND prod_price \u003e= 10; /*6 通配符*/ -- LIKE 模式匹配，只能用于字符串。出于性能考虑，最好放在过滤条件的最后 -- % 多个字符（任意字符出现任意次数），注意不会匹配 NULL SELECT prod_id, prod_name FROM Products WHERE prod_name LIKE '%teddy bear%'; -- _ 单个字符（不多也不少） SELECT prod_id, prod_name FROM Products WHERE prod_name LIKE '__ inch teddy bear%'; /*7 创建计算字段*/ -- TRIM() 函数清除左右两边的空格 -- || 拼接字段 -- AS 使用别名 SELECT vend_name || ' (' || vend_country || ')' AS vend_title FROM Vendors; SELECT TRIM(vend_name) || ' (' || TRIM(vend_country) || ')' AS vend_title FROM Vendors; -- 执行数字计算 SELECT prod_id, quantity, item_price, quantity * item_price AS expanded_price FROM OrderItems WHERE order_num = 20008; -- SELECT 语句可以用于测试表达式 SELECT 3 * 2; SELECT TRIM(' ABC '); SELECT NOW(); SELECT CURRENT_DATE; /*8 函数*/ -- 数值函数 -- 系统函数 -- 文本函数 SELECT vend_name, UPPER(vend_name) AS vend_name_upcase FROM Vendors; -- 时间函数 SELECT order_num FROM Orders WHERE DATE_PART('year', order_date) = 2012; /*9 汇总数据*/ -- 聚集函数 -- COUNT(*) 总行数 -- COUNT(column) 该列的行数（忽略 NULL） -- SUM(column) 该列的总和 -- AVG(column) 该列的平均值 -- MAX(column) 该列的最大值 -- MIN(column) 该列的最小值 -- 聚集不同值 -- DISTINCT 去重（缺省为所有行 ALL） SELECT COUNT(DISTINCT prod_price) AS num_price_dist, COUNT(prod_price) AS num_price, AVG(DISTINCT prod_price) AS avg_price_dist, AVG(prod_price) AS avg_price, MAX(prod_price) AS max_price, MIN(prod_price) AS min_price, SUM(prod_price) AS sum_price FROM Products WHERE vend_id = 'DLL01'; SELECT SUM(item_price * quantity) AS total_price FROM OrderItems WHERE order_num = 20005; /*10 分组数据*/ -- 创建分组 -- GROUP BY 子句指示 DBMS 进行数据分组，然后对每个组进行聚集，而不是对整个结果集 -- GROUP BY x 根据 x 列进行分组 -- GROUP BY x, y 根据 x 列和 y 列进行分组（将 x 列和 y 列的值视为一个整体来分组） SELECT vend_id, COUNT(*) AS num_prods FROM Products GROUP BY vend_id; -- 等同于 SELECT vend_id, COUNT(*) AS num_prods FROM Products GROUP BY 1; -- 过滤分组 -- WHERE 过滤行， -- HAVING 过滤组； -- WHERE 在数据分组前进行过滤， -- HAVING 在数据分组后进行过滤。 SELECT vend_id, COUNT(*) AS num_prods -- 计数 FROM Products WHERE prod_price \u003e= 4 -- 过滤（行级） GROUP BY 1 -- 分组 HAVING COUNT(*) \u003e= 2 -- 过滤（组级） ORDER BY num_prods, 1 DESC; -- 排序 /*11 子查询*/ -- 子查询：嵌套在其他查询中的查询，只能查询单个列，总是由内向外进行处理 -- 子查询性能不好，推荐使用联结（JOIN） -- 填充 IN 操作符 -- 显示订购产品 RGAN01 的顾客列表 SELECT order_num FROM OrderItems WHERE prod_id = 'RGAN01'; -- + SELECT cust_id FROM Orders WHERE order_num IN (20007, 20008); -- = SELECT cust_id FROM Orders WHERE order_num IN (SELECT order_num FROM OrderItems WHERE prod_id = 'RGAN01'); -- + SELECT cust_name, cust_contact FROM Customers WHERE cust_id IN ('1000000004', '1000000005'); -- = SELECT cust_name, cust_contact FROM Customers WHERE cust_id IN (SELECT cust_id FROM Orders WHERE order_num IN (SELECT order_num FROM OrderItems WHERE prod_id = 'RGAN01')); -- 填充计算列 SELECT COUNT(*) AS orders FROM Orders WHERE cust_id = '1000000001'; -- + SELECT cust_name, cust_state FROM Customers; -- = SELECT cust_name, cust_state, (SELECT COUNT(*) FROM Orders WHERE Orders.cust_id = Customers.cust_id) AS orders -- 避免歧义 FROM Customers; /*12 联结表*/ -- 联结机制：在一条 SELECT 语句中关联多个表中配对成功的行，返回一组输出 -- 联结方式：首先列出所有表，然后定义表之间的配对条件 -- 注意： -- ON 只用于连接行（联结） -- WHERE 只用于过滤行 -- 显示订购产品 RGAN01 的顾客列表 -- 等值联结（内联结） SELECT cust_name, cust_contact FROM Orders, Customers, OrderItems WHERE prod_id = 'RGAN01' AND Orders.order_num = OrderItems.order_num AND Orders.cust_id = Customers.cust_id; -- 简单格式 SELECT vend_name, prod_name FROM Vendors, Products WHERE Vendors.vend_id = Products.vend_id; -- 等同于 -- 标准格式 SELECT vend_name, prod_name FROM Vendors -- 联结机制 INNER JOIN Products ON Vendors.vend_id = Products.vend_id; -- 配对条件 /*13 高级联结*/ -- 自联结（self-join） -- 多次引用相同的表 SELECT c1.cust_id, c1.cust_name, c1.cust_contact FROM Customers AS c1, Customers AS c2 WHERE c2.cust_contact = 'Jim Jones' AND c1.cust_name = c2.cust_name; -- 自然联结（natural join） -- 等值联结（内联结）的特例化 -- 联结时，自动比较名称相同的列 -- 输出时，自动去除名称相同的列 SELECT * FROM Vendors NATURAL JOIN Products; -- 对比 SELECT * FROM Vendors INNER JOIN Products ON Vendors.vend_id = Products.vend_id; SELECT cust_name, cust_contact FROM Orders NATURAL JOIN Customers NATURAL JOIN OrderItems WHERE prod_id = 'RGAN01'; -- 外联结（outer join） -- 全外联结：内联结 + 全部表没有配对成功的行（FULL） -- 左外联结：内联结 + 左边表没有配对成功的行（LEFT） -- 右外联结：内联结 + 右边表没有配对成功的行（RIGHT） -- 左外联结和右外联结可以交换使用，区别在于关联表的顺序 SELECT Customers.cust_id, Orders.order_num FROM Customers LEFT OUTER JOIN Orders ON Customers.cust_id = Orders.cust_id; -- 等同于 SELECT Customers.cust_id, Orders.order_num FROM Orders RIGHT OUTER JOIN Customers ON Customers.cust_id = Orders.cust_id; -- 带有聚集函数的联结 SELECT Customers.cust_id, COUNT(Orders.order_num) AS num_ord FROM Customers LEFT OUTER JOIN Orders ON Customers.cust_id = Orders.cust_id GROUP BY Customers.cust_id ORDER BY 2 DESC; /*14 组合查询*/ -- 并（union）：执行多条 SELECT 语句，并合并为一个结果集 -- UNION 和 WHERE 的多个 OR 条件所完成的工作相同 -- UNION 无重复行， -- UNION ALL 有重复行。 SELECT cust_name, cust_contact FROM Customers WHERE cust_state IN ('IL', 'IN', 'MI') UNION SELECT cust_name, cust_contact FROM Customers WHERE cust_name = 'Fun4All'; -- 等同于 SELECT cust_name, cust_contact FROM Customers WHERE cust_state IN ('IL', 'IN', 'MI') OR cust_name = 'Fun4All'; /*15 插入数据*/ -- 插入完整行 INSERT INTO Customers VALUES ('1000000006', 'Toy Land', '123 Any Street', 'New York', 'NY', '11111', 'USA',NULL,NULL); -- 插入部分行 INSERT INTO Customers (cust_id, cust_name, cust_address, cust_city, cust_state, cust_zip) VALUES ('1000000006', 'Toy Land', '123 Any Street', 'New York', 'NY', '11111'); -- 导入行（INSERT SELECT） INSERT INTO Customers (cust_id, cust_name, cust_address, cust_city, cust_state, cust_zip) SELECT cust_id, cust_name, cust_address, cust_city, cust_state, cust_zip FROM CustNew; -- 导出行（SELECT INTO） SELECT * INTO CustNew FROM Customers; /*16 更新和删除数据*/ -- 更新指定行 UPDATE Customers SET cust_contact = 'Sam Roberts', cust_email = 'sam@toyland.com' WHERE cust_id = '1000000006'; UPDATE account SET \"role\" = CASE \"role\" WHEN 'USER1' THEN 'STAFF1' WHEN 'USER2' THEN 'STAFF2' ELSE \"role\" END; -- 删除指定行 DELETE FROM Customers WHERE cust_id = '1000000006'; -- 删除所有行 TRUNCATE TABLE Customers; /*17 创建和操纵表*/ /*18 视图*/ -- 一张虚拟表，包含的不是数据，而是 SELECT 语句，用于动态检索数据，可以重用 SQL，简化复杂数据的处理 -- 创建视图 -- 用于封装复杂的查询语句 CREATE OR REPLACE VIEW ProductCustomers AS SELECT cust_name, cust_contact, prod_id FROM Customers, Orders, OrderItems WHERE Customers.cust_id = Orders.cust_id AND OrderItems.order_num = Orders.order_num; -- 用于简化计算字段 CREATE OR REPLACE VIEW OrderItemsExpanded AS SELECT prod_id, quantity, item_price, quantity * item_price AS expanded_price, order_num FROM OrderItems; -- 用于格式化检索出的数据 CREATE OR REPLACE VIEW VendorLocations AS SELECT TRIM(vend_name) || ' (' || TRIM(vend_country) || ')' AS vend_title FROM Vendors; -- 使用视图 SELECT * FROM ProductCustomers WHERE prod_id = 'RGAN01'; SELECT * FROM OrderItemsExpanded WHERE order_num = 20008; SELECT * FROM VendorLocations; -- 删除视图 DROP VIEW ProductCustomers; /*19 存储过程*/ /*20 事务处理*/ /*21 游标*/ /*22 SQL 特性*/ -- 约束：管理如何插入或处理数据库数据 -- 主键 ALTER TABLE Vendors ADD PRIMARY KEY (vend_id); -- 外键 ALTER TABLE Orders ADD FOREIGN KEY (cust_id) REFERENCES Customers (cust_id); -- 检查约束 ALTER TABLE OrderItems ADD CHECK (quantity \u003e 0); -- 唯一约束 -- 索引：改善检索数据的性能 -- 用于对列进行过滤和排序 -- 取值范围越大的列做索引效果越好，比如姓名列就比性别列收益高 CREATE INDEX prod_name_ind ON Products (prod_name); -- 触发器：特殊的存储过程，在单表发生特定动作时自动执行 -- INSERT 时能够访问新数据 -- UPDATE 时能够访问新数据和旧数据 -- DELETE 时能够访问删除的数据 CREATE TABLE emp ( empname TEXT, salary INTEGER, last_user TEXT, last_date TIMESTAMP ); CREATE OR REPLACE FUNCTION emp_stamp() RETURNS TRIGGER AS $$ BEGIN IF NEW.empname IS NULL THEN RAISE EXCEPTION 'empname cannot be null'; END IF; IF NEW.salary IS NULL THEN RAISE EXCEPTION '% cannot have null salary', NEW.empname; END IF; IF NEW.salary \u003c 0 THEN RAISE EXCEPTION '% cannot have a negative salary', NEW.empname; END IF; -- 记录最后操作的人和日期 NEW.last_user := current_user; NEW.last_date := current_timestamp; RETURN NEW; END; $$ LANGUAGE plpgsql; CREATE TRIGGER emp_stamp BEFORE INSERT OR UPDATE ON emp FOR EACH ROW EXECUTE PROCEDURE emp_stamp(); Reference SQL 风格 https://www.sqlstyle.guide/zh/ https://launchbylunch.com/posts/2014/Feb/16/sql-naming-conventions/ SQL Select https://www.sqlite.org/lang_select.html https://www.postgresql.org/docs/current/queries-table-expressions.html ","wordCount":"1315","inLanguage":"en","datePublished":"2018-04-07T15:05:01+08:00","dateModified":"2018-04-07T15:05:01+08:00","author":{"@type":"Person","name":"XhstormR"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xhstormr.github.io/blog/posts/sql/"},"publisher":{"@type":"Organization","name":"XhstormR","logo":{"@type":"ImageObject","url":"https://xhstormr.github.io/blog/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xhstormr.github.io/blog/ accesskey=h title="XhstormR (Alt + H)">XhstormR</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://xhstormr.github.io/blog/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://xhstormr.github.io/blog/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://xhstormr.github.io/blog/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://xhstormr.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://xhstormr.github.io/blog/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">SQL 必知必会</h1><div class=post-meta><span title='2018-04-07 15:05:01 +0800 +0800'>2018-04-07</span>&nbsp;·&nbsp;<span>7 min</span>&nbsp;·&nbsp;<span>XhstormR</span>&nbsp;|&nbsp;<span>
<a href=https://github.com/XhstormR/blog/tree/master/content/posts/sql.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#reference aria-label=Reference>Reference</a></li></ul></div></details></div><div class=post-content><p>Updated on 2018-04-14</p><blockquote><img loading=lazy src=/blog/uploads/sql-query-order.png title="Select Query Order" width=650><p><a href=https://zh.m.wikipedia.org/zh-cn/SQL>https://zh.m.wikipedia.org/zh-cn/SQL</a></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>/*2 检索*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> prod_name
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- DISTINCT 去重，作用于所有列
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>DISTINCT</span> vend_id
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- LIMIT 限制数量，OFFSET 偏移数量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> prod_name
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>LIMIT</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>OFFSET</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*3 排序*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- ORDER BY 排序
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> prod_name
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> prod_name;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 按多个列排序
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  prod_id,
</span></span><span style=display:flex><span>  prod_price,
</span></span><span style=display:flex><span>  prod_name
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> prod_price, prod_name;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 等同于
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  prod_id,
</span></span><span style=display:flex><span>  prod_price,
</span></span><span style=display:flex><span>  prod_name
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- DESC 降序排序（缺省为升序 ASC）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  prod_id,
</span></span><span style=display:flex><span>  prod_price,
</span></span><span style=display:flex><span>  prod_name
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> prod_price <span style=color:#66d9ef>DESC</span>, prod_name;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*4 过滤*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 检查单个值
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  prod_name,
</span></span><span style=display:flex><span>  prod_price
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> prod_price <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>.<span style=color:#ae81ff>49</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  prod_name,
</span></span><span style=display:flex><span>  prod_price
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> prod_price <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 不匹配检查
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  vend_id,
</span></span><span style=display:flex><span>  prod_name
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> vend_id <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;DLL01&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 范围值检查
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  prod_name,
</span></span><span style=display:flex><span>  prod_price
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> prod_price <span style=color:#66d9ef>BETWEEN</span> <span style=color:#ae81ff>5</span> <span style=color:#66d9ef>AND</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 空值检查
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> cust_name
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> CUSTOMERS
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> cust_email <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*5 高级过滤*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- AND 且
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  prod_name,
</span></span><span style=display:flex><span>  prod_price
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> vend_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;DLL01&#39;</span> <span style=color:#66d9ef>AND</span> prod_price <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- OR 或
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  prod_name,
</span></span><span style=display:flex><span>  prod_price
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> vend_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;DLL01&#39;</span> <span style=color:#66d9ef>OR</span> vend_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;BRS01&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- NOT 非，条件取反，可以否定（取反）任何条件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  prod_name,
</span></span><span style=display:flex><span>  prod_price
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>NOT</span> vend_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;FNG01&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- IN 条件范围，与 OR 功能相当，推荐使用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  prod_name,
</span></span><span style=display:flex><span>  prod_price
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> vend_id <span style=color:#66d9ef>IN</span> (<span style=color:#e6db74>&#39;DLL01&#39;</span>, <span style=color:#e6db74>&#39;BRS01&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- () 条件组合，管理比较顺序
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  prod_name,
</span></span><span style=display:flex><span>  prod_price
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> (vend_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;DLL01&#39;</span> <span style=color:#66d9ef>OR</span> vend_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;BRS01&#39;</span>) <span style=color:#66d9ef>AND</span> prod_price <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*6 通配符*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- LIKE 模式匹配，只能用于字符串。出于性能考虑，最好放在过滤条件的最后
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- % 多个字符（任意字符出现任意次数），注意不会匹配 NULL
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  prod_id,
</span></span><span style=display:flex><span>  prod_name
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> prod_name <span style=color:#66d9ef>LIKE</span> <span style=color:#e6db74>&#39;%teddy bear%&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- _ 单个字符（不多也不少）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  prod_id,
</span></span><span style=display:flex><span>  prod_name
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> prod_name <span style=color:#66d9ef>LIKE</span> <span style=color:#e6db74>&#39;__ inch teddy bear%&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*7 创建计算字段*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- TRIM() 函数清除左右两边的空格
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- || 拼接字段
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- AS 使用别名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> vend_name <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39; (&#39;</span> <span style=color:#f92672>||</span> vend_country <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;)&#39;</span> <span style=color:#66d9ef>AS</span> vend_title
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Vendors;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>TRIM</span>(vend_name) <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39; (&#39;</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>TRIM</span>(vend_country) <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;)&#39;</span> <span style=color:#66d9ef>AS</span> vend_title
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Vendors;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 执行数字计算
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  prod_id,
</span></span><span style=display:flex><span>  quantity,
</span></span><span style=display:flex><span>  item_price,
</span></span><span style=display:flex><span>  quantity <span style=color:#f92672>*</span> item_price <span style=color:#66d9ef>AS</span> expanded_price
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> OrderItems
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> order_num <span style=color:#f92672>=</span> <span style=color:#ae81ff>20008</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- SELECT 语句可以用于测试表达式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>TRIM</span>(<span style=color:#e6db74>&#39;  ABC  &#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> NOW();
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>CURRENT_DATE</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*8 函数*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 数值函数
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 系统函数
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 文本函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  vend_name,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>UPPER</span>(vend_name) <span style=color:#66d9ef>AS</span> vend_name_upcase
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Vendors;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 时间函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> order_num
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Orders
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> DATE_PART(<span style=color:#e6db74>&#39;year&#39;</span>, order_date) <span style=color:#f92672>=</span> <span style=color:#ae81ff>2012</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*9 汇总数据*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 聚集函数
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- COUNT(*)      总行数
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- COUNT(column) 该列的行数（忽略 NULL）
</span></span></span><span style=display:flex><span><span style=color:#75715e>--   SUM(column) 该列的总和
</span></span></span><span style=display:flex><span><span style=color:#75715e>--   AVG(column) 该列的平均值
</span></span></span><span style=display:flex><span><span style=color:#75715e>--   MAX(column) 该列的最大值
</span></span></span><span style=display:flex><span><span style=color:#75715e>--   MIN(column) 该列的最小值
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 聚集不同值
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- DISTINCT 去重（缺省为所有行 ALL）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>COUNT</span>(<span style=color:#66d9ef>DISTINCT</span> prod_price) <span style=color:#66d9ef>AS</span> num_price_dist,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>COUNT</span>(prod_price)          <span style=color:#66d9ef>AS</span> num_price,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>AVG</span>(<span style=color:#66d9ef>DISTINCT</span> prod_price)   <span style=color:#66d9ef>AS</span> avg_price_dist,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>AVG</span>(prod_price)            <span style=color:#66d9ef>AS</span> avg_price,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>MAX</span>(prod_price)            <span style=color:#66d9ef>AS</span> max_price,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>MIN</span>(prod_price)            <span style=color:#66d9ef>AS</span> min_price,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>SUM</span>(prod_price)            <span style=color:#66d9ef>AS</span> sum_price
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> vend_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;DLL01&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>SUM</span>(item_price <span style=color:#f92672>*</span> quantity) <span style=color:#66d9ef>AS</span> total_price
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> OrderItems
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> order_num <span style=color:#f92672>=</span> <span style=color:#ae81ff>20005</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*10 分组数据*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建分组
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- GROUP BY 子句指示 DBMS 进行数据分组，然后对每个组进行聚集，而不是对整个结果集
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- GROUP BY x 根据 x 列进行分组
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- GROUP BY x, y 根据 x 列和 y 列进行分组（将 x 列和 y 列的值视为一个整体来分组）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  vend_id,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>AS</span> num_prods
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> vend_id;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 等同于
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  vend_id,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>AS</span> num_prods
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 过滤分组
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- WHERE  过滤行，
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- HAVING 过滤组；
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- WHERE  在数据分组前进行过滤，
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- HAVING 在数据分组后进行过滤。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  vend_id,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>AS</span> num_prods <span style=color:#75715e>-- 计数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>FROM</span> Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> prod_price <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>4</span> <span style=color:#75715e>-- 过滤（行级）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> <span style=color:#ae81ff>1</span> <span style=color:#75715e>-- 分组
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>HAVING</span> <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>2</span> <span style=color:#75715e>-- 过滤（组级）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> num_prods, <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>DESC</span>; <span style=color:#75715e>-- 排序
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*11 子查询*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 子查询：嵌套在其他查询中的查询，只能查询单个列，总是由内向外进行处理
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 子查询性能不好，推荐使用联结（JOIN）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 填充 IN 操作符
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 显示订购产品 RGAN01 的顾客列表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> order_num
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> OrderItems
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> prod_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;RGAN01&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- +
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> cust_id
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Orders
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> order_num <span style=color:#66d9ef>IN</span> (<span style=color:#ae81ff>20007</span>, <span style=color:#ae81ff>20008</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- =
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> cust_id
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Orders
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> order_num <span style=color:#66d9ef>IN</span> (<span style=color:#66d9ef>SELECT</span> order_num
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>FROM</span> OrderItems
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHERE</span> prod_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;RGAN01&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- +
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  cust_name,
</span></span><span style=display:flex><span>  cust_contact
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Customers
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> cust_id <span style=color:#66d9ef>IN</span> (<span style=color:#e6db74>&#39;1000000004&#39;</span>, <span style=color:#e6db74>&#39;1000000005&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- =
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  cust_name,
</span></span><span style=display:flex><span>  cust_contact
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Customers
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> cust_id <span style=color:#66d9ef>IN</span> (<span style=color:#66d9ef>SELECT</span> cust_id
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>FROM</span> Orders
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>WHERE</span> order_num <span style=color:#66d9ef>IN</span> (<span style=color:#66d9ef>SELECT</span> order_num
</span></span><span style=display:flex><span>                                      <span style=color:#66d9ef>FROM</span> OrderItems
</span></span><span style=display:flex><span>                                      <span style=color:#66d9ef>WHERE</span> prod_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;RGAN01&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 填充计算列
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>AS</span> orders
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Orders
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> cust_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;1000000001&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- +
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  cust_name,
</span></span><span style=display:flex><span>  cust_state
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Customers;
</span></span><span style=display:flex><span><span style=color:#75715e>-- =
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  cust_name,
</span></span><span style=display:flex><span>  cust_state,
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>)
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>FROM</span> Orders
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>WHERE</span> Orders.cust_id <span style=color:#f92672>=</span> Customers.cust_id) <span style=color:#66d9ef>AS</span> orders <span style=color:#75715e>-- 避免歧义
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>FROM</span> Customers;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*12 联结表*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 联结机制：在一条 SELECT 语句中关联多个表中配对成功的行，返回一组输出
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 联结方式：首先列出所有表，然后定义表之间的配对条件
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 注意：
</span></span></span><span style=display:flex><span><span style=color:#75715e>--    ON 只用于连接行（联结）
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- WHERE 只用于过滤行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 显示订购产品 RGAN01 的顾客列表
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 等值联结（内联结）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  cust_name,
</span></span><span style=display:flex><span>  cust_contact
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Orders, Customers, OrderItems
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> prod_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;RGAN01&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>AND</span> Orders.order_num <span style=color:#f92672>=</span> OrderItems.order_num
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>AND</span> Orders.cust_id <span style=color:#f92672>=</span> Customers.cust_id;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 简单格式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  vend_name,
</span></span><span style=display:flex><span>  prod_name
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Vendors, Products
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> Vendors.vend_id <span style=color:#f92672>=</span> Products.vend_id;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 等同于
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 标准格式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  vend_name,
</span></span><span style=display:flex><span>  prod_name
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Vendors
</span></span><span style=display:flex><span>  <span style=color:#75715e>-- 联结机制
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>INNER</span> <span style=color:#66d9ef>JOIN</span> Products
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ON</span> Vendors.vend_id <span style=color:#f92672>=</span> Products.vend_id; <span style=color:#75715e>-- 配对条件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*13 高级联结*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 自联结（self-join）
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 多次引用相同的表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  c1.cust_id,
</span></span><span style=display:flex><span>  c1.cust_name,
</span></span><span style=display:flex><span>  c1.cust_contact
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Customers <span style=color:#66d9ef>AS</span> c1, Customers <span style=color:#66d9ef>AS</span> c2
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> c2.cust_contact <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Jim Jones&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>AND</span> c1.cust_name <span style=color:#f92672>=</span> c2.cust_name;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 自然联结（natural join）
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 等值联结（内联结）的特例化
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 联结时，自动比较名称相同的列
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 输出时，自动去除名称相同的列
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Vendors
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>NATURAL</span> <span style=color:#66d9ef>JOIN</span> Products;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 对比
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Vendors
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>INNER</span> <span style=color:#66d9ef>JOIN</span> Products
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ON</span> Vendors.vend_id <span style=color:#f92672>=</span> Products.vend_id;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  cust_name,
</span></span><span style=display:flex><span>  cust_contact
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Orders
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>NATURAL</span> <span style=color:#66d9ef>JOIN</span> Customers
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>NATURAL</span> <span style=color:#66d9ef>JOIN</span> OrderItems
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> prod_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;RGAN01&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 外联结（outer join）
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 全外联结：内联结 + 全部表没有配对成功的行（FULL）
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 左外联结：内联结 + 左边表没有配对成功的行（LEFT）
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 右外联结：内联结 + 右边表没有配对成功的行（RIGHT）
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 左外联结和右外联结可以交换使用，区别在于关联表的顺序
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  Customers.cust_id,
</span></span><span style=display:flex><span>  Orders.order_num
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Customers
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>OUTER</span> <span style=color:#66d9ef>JOIN</span> Orders
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ON</span> Customers.cust_id <span style=color:#f92672>=</span> Orders.cust_id;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 等同于
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  Customers.cust_id,
</span></span><span style=display:flex><span>  Orders.order_num
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Orders
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>RIGHT</span> <span style=color:#66d9ef>OUTER</span> <span style=color:#66d9ef>JOIN</span> Customers
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ON</span> Customers.cust_id <span style=color:#f92672>=</span> Orders.cust_id;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 带有聚集函数的联结
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  Customers.cust_id,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>COUNT</span>(Orders.order_num) <span style=color:#66d9ef>AS</span> num_ord
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Customers
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>LEFT</span> <span style=color:#66d9ef>OUTER</span> <span style=color:#66d9ef>JOIN</span> Orders
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ON</span> Customers.cust_id <span style=color:#f92672>=</span> Orders.cust_id
</span></span><span style=display:flex><span><span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> Customers.cust_id
</span></span><span style=display:flex><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> <span style=color:#ae81ff>2</span> <span style=color:#66d9ef>DESC</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*14 组合查询*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 并（union）：执行多条 SELECT 语句，并合并为一个结果集
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- UNION 和 WHERE 的多个 OR 条件所完成的工作相同
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- UNION     无重复行，
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- UNION ALL 有重复行。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  cust_name,
</span></span><span style=display:flex><span>  cust_contact
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Customers
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> cust_state <span style=color:#66d9ef>IN</span> (<span style=color:#e6db74>&#39;IL&#39;</span>, <span style=color:#e6db74>&#39;IN&#39;</span>, <span style=color:#e6db74>&#39;MI&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>UNION</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  cust_name,
</span></span><span style=display:flex><span>  cust_contact
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Customers
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> cust_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Fun4All&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 等同于
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>  cust_name,
</span></span><span style=display:flex><span>  cust_contact
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Customers
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> cust_state <span style=color:#66d9ef>IN</span> (<span style=color:#e6db74>&#39;IL&#39;</span>, <span style=color:#e6db74>&#39;IN&#39;</span>, <span style=color:#e6db74>&#39;MI&#39;</span>)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>OR</span> cust_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Fun4All&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*15 插入数据*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 插入完整行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> Customers
</span></span><span style=display:flex><span><span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;1000000006&#39;</span>, <span style=color:#e6db74>&#39;Toy Land&#39;</span>, <span style=color:#e6db74>&#39;123 Any Street&#39;</span>, <span style=color:#e6db74>&#39;New York&#39;</span>, <span style=color:#e6db74>&#39;NY&#39;</span>, <span style=color:#e6db74>&#39;11111&#39;</span>, <span style=color:#e6db74>&#39;USA&#39;</span>,<span style=color:#66d9ef>NULL</span>,<span style=color:#66d9ef>NULL</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 插入部分行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> Customers (cust_id, cust_name, cust_address, cust_city, cust_state, cust_zip)
</span></span><span style=display:flex><span><span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;1000000006&#39;</span>, <span style=color:#e6db74>&#39;Toy Land&#39;</span>, <span style=color:#e6db74>&#39;123 Any Street&#39;</span>, <span style=color:#e6db74>&#39;New York&#39;</span>, <span style=color:#e6db74>&#39;NY&#39;</span>, <span style=color:#e6db74>&#39;11111&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 导入行（INSERT SELECT）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> Customers (cust_id, cust_name, cust_address, cust_city, cust_state, cust_zip)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>    cust_id,
</span></span><span style=display:flex><span>    cust_name,
</span></span><span style=display:flex><span>    cust_address,
</span></span><span style=display:flex><span>    cust_city,
</span></span><span style=display:flex><span>    cust_state,
</span></span><span style=display:flex><span>    cust_zip
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> CustNew;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 导出行（SELECT INTO）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>INTO</span> CustNew
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> Customers;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*16 更新和删除数据*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 更新指定行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>UPDATE</span> Customers
</span></span><span style=display:flex><span><span style=color:#66d9ef>SET</span> cust_contact <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Sam Roberts&#39;</span>,
</span></span><span style=display:flex><span>  cust_email     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;sam@toyland.com&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> cust_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;1000000006&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>UPDATE</span> account
</span></span><span style=display:flex><span><span style=color:#66d9ef>SET</span> <span style=color:#e6db74>&#34;role&#34;</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CASE</span> <span style=color:#e6db74>&#34;role&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>WHEN</span> <span style=color:#e6db74>&#39;USER1&#39;</span> <span style=color:#66d9ef>THEN</span> <span style=color:#e6db74>&#39;STAFF1&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>WHEN</span> <span style=color:#e6db74>&#39;USER2&#39;</span> <span style=color:#66d9ef>THEN</span> <span style=color:#e6db74>&#39;STAFF2&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>ELSE</span> <span style=color:#e6db74>&#34;role&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>END</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除指定行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>FROM</span> Customers
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> cust_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;1000000006&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除所有行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>TRUNCATE</span> <span style=color:#66d9ef>TABLE</span> Customers;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*17 创建和操纵表*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*18 视图*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 一张虚拟表，包含的不是数据，而是 SELECT 语句，用于动态检索数据，可以重用 SQL，简化复杂数据的处理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建视图
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 用于封装复杂的查询语句
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>OR</span> <span style=color:#66d9ef>REPLACE</span> <span style=color:#66d9ef>VIEW</span> ProductCustomers <span style=color:#66d9ef>AS</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>    cust_name,
</span></span><span style=display:flex><span>    cust_contact,
</span></span><span style=display:flex><span>    prod_id
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> Customers, Orders, OrderItems
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>WHERE</span> Customers.cust_id <span style=color:#f92672>=</span> Orders.cust_id
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>AND</span> OrderItems.order_num <span style=color:#f92672>=</span> Orders.order_num;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 用于简化计算字段
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>OR</span> <span style=color:#66d9ef>REPLACE</span> <span style=color:#66d9ef>VIEW</span> OrderItemsExpanded <span style=color:#66d9ef>AS</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>SELECT</span>
</span></span><span style=display:flex><span>    prod_id,
</span></span><span style=display:flex><span>    quantity,
</span></span><span style=display:flex><span>    item_price,
</span></span><span style=display:flex><span>    quantity <span style=color:#f92672>*</span> item_price <span style=color:#66d9ef>AS</span> expanded_price,
</span></span><span style=display:flex><span>    order_num
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> OrderItems;
</span></span><span style=display:flex><span><span style=color:#75715e>-- 用于格式化检索出的数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>OR</span> <span style=color:#66d9ef>REPLACE</span> <span style=color:#66d9ef>VIEW</span> VendorLocations <span style=color:#66d9ef>AS</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>TRIM</span>(vend_name) <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39; (&#39;</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>TRIM</span>(vend_country) <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;)&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>AS</span> vend_title
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> Vendors;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 使用视图
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> ProductCustomers
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> prod_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;RGAN01&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> OrderItemsExpanded
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> order_num <span style=color:#f92672>=</span> <span style=color:#ae81ff>20008</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> VendorLocations;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除视图
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>VIEW</span> ProductCustomers;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*19 存储过程*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*20 事务处理*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*21 游标*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*22 SQL 特性*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 约束：管理如何插入或处理数据库数据
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 主键
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> Vendors
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (vend_id);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 外键
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> Orders
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span> (cust_id) <span style=color:#66d9ef>REFERENCES</span> Customers (cust_id);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 检查约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> OrderItems
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>ADD</span> <span style=color:#66d9ef>CHECK</span> (quantity <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>-- 唯一约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 索引：改善检索数据的性能
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 用于对列进行过滤和排序
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 取值范围越大的列做索引效果越好，比如姓名列就比性别列收益高
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> prod_name_ind
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>ON</span> Products (prod_name);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 触发器：特殊的存储过程，在单表发生特定动作时自动执行
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- INSERT 时能够访问新数据
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- UPDATE 时能够访问新数据和旧数据
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- DELETE 时能够访问删除的数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> emp (
</span></span><span style=display:flex><span>  empname   TEXT,
</span></span><span style=display:flex><span>  salary    INTEGER,
</span></span><span style=display:flex><span>  last_user TEXT,
</span></span><span style=display:flex><span>  last_date <span style=color:#66d9ef>TIMESTAMP</span>
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>OR</span> <span style=color:#66d9ef>REPLACE</span> <span style=color:#66d9ef>FUNCTION</span> emp_stamp()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>RETURNS</span> <span style=color:#66d9ef>TRIGGER</span> <span style=color:#66d9ef>AS</span> <span style=color:#960050;background-color:#1e0010>$$</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>BEGIN</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NEW</span>.empname <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>THEN</span>
</span></span><span style=display:flex><span>    RAISE <span style=color:#66d9ef>EXCEPTION</span> <span style=color:#e6db74>&#39;empname cannot be null&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>END</span> <span style=color:#66d9ef>IF</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NEW</span>.salary <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>THEN</span>
</span></span><span style=display:flex><span>    RAISE <span style=color:#66d9ef>EXCEPTION</span> <span style=color:#e6db74>&#39;% cannot have null salary&#39;</span>, <span style=color:#66d9ef>NEW</span>.empname;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>END</span> <span style=color:#66d9ef>IF</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>NEW</span>.salary <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>THEN</span>
</span></span><span style=display:flex><span>    RAISE <span style=color:#66d9ef>EXCEPTION</span> <span style=color:#e6db74>&#39;% cannot have a negative salary&#39;</span>, <span style=color:#66d9ef>NEW</span>.empname;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>END</span> <span style=color:#66d9ef>IF</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>-- 记录最后操作的人和日期
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>NEW</span>.last_user :<span style=color:#f92672>=</span> <span style=color:#66d9ef>current_user</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>NEW</span>.last_date :<span style=color:#f92672>=</span> <span style=color:#66d9ef>current_timestamp</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>RETURN</span> <span style=color:#66d9ef>NEW</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>END</span>;
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>$$</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>LANGUAGE</span> plpgsql;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> emp_stamp
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>BEFORE</span> <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>OR</span> <span style=color:#66d9ef>UPDATE</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>ON</span> emp
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FOR</span> <span style=color:#66d9ef>EACH</span> <span style=color:#66d9ef>ROW</span> <span style=color:#66d9ef>EXECUTE</span> <span style=color:#66d9ef>PROCEDURE</span> emp_stamp();
</span></span></code></pre></div><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><ul><li>SQL 风格<ul><li><a href=https://www.sqlstyle.guide/zh/>https://www.sqlstyle.guide/zh/</a></li><li><a href=https://launchbylunch.com/posts/2014/Feb/16/sql-naming-conventions/>https://launchbylunch.com/posts/2014/Feb/16/sql-naming-conventions/</a></li></ul></li><li>SQL Select<ul><li><a href=https://www.sqlite.org/lang_select.html#fromclause>https://www.sqlite.org/lang_select.html</a></li><li><a href=https://www.postgresql.org/docs/current/queries-table-expressions.html#QUERIES-FROM>https://www.postgresql.org/docs/current/queries-table-expressions.html</a></li></ul></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://xhstormr.github.io/blog/tags/sql/>SQL</a></li></ul><nav class=paginav><a class=prev href=https://xhstormr.github.io/blog/posts/qemu/><span class=title>« Prev</span><br><span>QEMU</span>
</a><a class=next href=https://xhstormr.github.io/blog/posts/swagger/><span class=title>Next »</span><br><span>Swagger API</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share SQL 必知必会 on x" href="https://x.com/intent/tweet/?text=SQL%20%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a&amp;url=https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fsql%2f&amp;hashtags=SQL"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SQL 必知必会 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fsql%2f&amp;title=SQL%20%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a&amp;summary=SQL%20%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a&amp;source=https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fsql%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SQL 必知必会 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fsql%2f&title=SQL%20%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SQL 必知必会 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fsql%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SQL 必知必会 on whatsapp" href="https://api.whatsapp.com/send?text=SQL%20%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a%20-%20https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fsql%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SQL 必知必会 on telegram" href="https://telegram.me/share/url?text=SQL%20%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a&amp;url=https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fsql%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SQL 必知必会 on ycombinator" href="https://news.ycombinator.com/submitlink?t=SQL%20%e5%bf%85%e7%9f%a5%e5%bf%85%e4%bc%9a&u=https%3a%2f%2fxhstormr.github.io%2fblog%2fposts%2fsql%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://xhstormr.github.io/blog/>XhstormR</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>